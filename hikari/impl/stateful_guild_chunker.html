<!--
Copyright (c) 2020 Nekokatt
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<!--
Copyright (c) 2020 Nekokatt
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>hikari.impl.stateful_guild_chunker API documentation</title>
<meta name="description" content="Basic implementation of a guild chunker." />
<meta property="og:title" content="hikari.impl.stateful_guild_chunker module documentation" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://hikari-py.github.io/hikari/logo.png" />
<meta property="og:description" content="A Discord Bot framework for modern Python and asyncio built on good intentions" />
<meta property="theme-color" content="#ff029a" />
<link rel="shortcut icon" type="image/png" href="https://hikari-py.github.io/hikari/logo.png"/>
<!--<script async src="https://cse.google.com/cse.js?cx=017837193012385208679:pey8ky8gdqw"></script>
<style>.gsc-control-cse {padding:0 !important;margin-top:1em}</style>-->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css" rel="stylesheet"/>
<style>
* {
scrollbar-color: #202324 #454a4d;
scroll-behavior: smooth;
}
img#logo {
border-radius: 15px;
width: 30px;
height: 30px;
margin-right: 0.5em;
}
small.smaller {
font-size: 0.75em;
}
body {
background-color: #181A1B;
color: #C9C5C0;
}
h1 {
margin-top: 3rem;
}
h2 {
margin-top: 1.75rem;
margin-bottom: 1em;
}
h3 {
margin-top: 1.25rem;
}
h4 {
margin-top: 1rem;
}
.nav-section {
margin-top: 2em;
}
.monospaced {
font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}
a.sidebar-nav-pill,
a.sidebar-nav-pill:active,
a.sidebar-nav-pill:hover {
color: #BDB7AF;
}
.module-source > details > pre {
display: block;
overflow-x: auto;
overflow-y: auto;
max-height: 600px;
font-size: 0.8em;
}
a {
color: #DE4F91;
}
a:hover {
color: #64B1F2;
}
.jumbotron {
background-color: #232627;
}
.breadcrumb-item.inactive > a {
color: #d264d0 !important;
}
.breadcrumb-item.active > a {
color: #de4f91 !important;
}
.breadcrumb-item+.breadcrumb-item::before {
content: ".";
}
.module-breadcrumb {
padding-left: 0 !important;
background-color: #232627;
}
ul.nested {
margin-left: 1em;
}
h2#parameters::after {
margin-left: 2em;
}
dt {
margin-left: 2em;
}
dd {
margin-left: 4em;
}
dl.no-nest > dt {
margin-left: 0em;
}
dl.no-nest > dd {
margin-left: 2em;
}
dl.root {
margin-bottom: 2em;
}
.definition {
display: block;
margin-bottom: 8em !important;
}
.definition .row {
display: block;
margin-bottom: 4em !important;
}
.definition h2 {
font-size: 1em;
font-weight: bolder;
}
.sep {
height: 2em;
}
code {
color: #DB61D9;
}
code .active {
color: #e83e8c;
}
code a {
color: #E94A93;
}
a.dotted:hover, abbr:hover {
text-decoration: underline #9E9689 dotted !important;
}
a.dotted, abbr {
text-decoration: none !important;
}
.gsc-search-box, .gsc-search-box-tools, .gsc-control-cse {
background: none !important;
border: none !important;
}
.gsc-search-button-v2, .gsc-search-button-v2:hover, .gsc-search-button-v2:focus {
color: var(--success) !important;
border-color: var(--success) !important;
background: none !important;
padding: 6px 32px !important;
font-size: inherit !important;
}
.gsc-search-button-v2 > svg {
fill: var(--success) !important;
}
.gsc-input-box {
border-radius: 3px;
}
.gsc-control-cse {
width: 300px !important;
margin-top: 0 !important;
}
.gsc-control-cse .gsc-control-cse-en {
margin-top: 0 !important;
}
.bg-dark {
background-color: #2C2F31 !important;
}
.text-muted {
color: #9E9689 !important;
}
.alert-primary {
color: #7CC3FF;
background-color: #262A2B;
border-color: #003B7B;
}
.alert-secondary {
color: #C2BCB4;
background-color: #282B2C;
border-color: #3B4042;
}
.alert-success {
color: #99E6AB;
background-color: #1A3E29;
border-color: #255A32;
}
.alert-info {
color: #8EE3F1;
background-color: #143B43;
border-color: #1E5961;
}
.alert-warning {
color: #FBD770;
background-color: #513E00;
border-color: #7B5C00;
}
.alert-danger {
color: rgb(225, 134, 143);
background-color: rgb(67, 12, 17);
border-color: rgb(104, 18, 27);
}
mark {
background-color: #333333;
border-radius: 0.1em;
color: #DB61D9;
}
</style>
<script async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML'></script>
</head>
<body>
<!-- body.mako -->
<nav id="main-nav" class="navbar navbar-dark navbar-expand-lg bg-dark">
<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"/>
</button>
<a class="navbar-brand" href="https://github.com/hikari-py/hikari"><img class="d-inline-block align-top" src="https://hikari-py.github.io/hikari/logo.png" id="logo" alt="hikari logo" loading="lazy"/>Hikari <small>v2.0.0.dev92</small></a>
<div class="collapse navbar-collapse" id="navbarNavDropdown">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/hikari/index.html">Home</a></li>
<li class="nav-item active"><a class="nav-link" href="/hikari/hikari/index.html">Documentation</a></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/hikari-py/hikari">GitHub</a></li>
<li class="nav-item"><a class="nav-link" href="https://pypi.org/project/hikari">PyPI</a></li>
<li class="nav-item"><a class="nav-link" href="https://discord.gg/Jx4cNGG">Discord Server</a></li>
</ul>
<form class="form-inline" >
<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" id="lunr-search"/>
<button class="btn btn-outline-success my-2 my-sm-0" type="submit">&gt;</button>
</form>
</div>
</nav>
<div class="jumbotron jumbotron-fluid">
<div class="container">
<h1 class="display-4"><code>
<nav aria-label="breadcrumb">
<ol class="breadcrumb module-breadcrumb">
<li class="breadcrumb-item inactive"><a title="hikari -- A sane Python framework for writing modern Discord bots …" href="../index.html"
>hikari</a></li>
<li class="breadcrumb-item inactive"><a title="hikari.impl -- Basic implementations of application components …" href="index.html"
>impl</a></li>
<li class="breadcrumb-item active"><a href="#">stateful_guild_chunker</a></li>
</ol>
</nav>
</code></h1>
<p class="lead"><p>Basic implementation of a guild chunker.</p></p>
</div>
</div>
<div class="container-xl">
<div class="row">
<div class="d-md-none d-lg-block col-lg-5 col-xl-4">
<!--<nav class="nav" id="content-nav">-->
<h3>This module</h3>
<ul class="list-unstyled text-truncate">
<li class="monospaced">
<small class='text-muted'><em><abbr title='A standard Python type.'>class</abbr></em></small> <a title="ChunkStream -- A specialised event stream used for triggering and streaming chunk events …" href="#hikari.impl.stateful_guild_chunker.ChunkStream"
>ChunkStream</a>
<ul class="list-unstyled nested text-truncate">
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="awaiting -- Await each item concurrently in a fixed size window …" href="../iterators.html#hikari.iterators.LazyIterator.awaiting"
>awaiting</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="chunk -- Return results in chunks of up to `chunk_size` amount of entries …" href="../iterators.html#hikari.iterators.LazyIterator.chunk"
>chunk</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="close -- Mark this streamer as closed to stop it from queueing and receiving events …" href="../event_stream.html#hikari.event_stream.EventStream.close"
>close</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="collect -- Collect the results into a given type and return it …" href="../iterators.html#hikari.iterators.LazyIterator.collect"
>collect</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="count -- Count the number of results …" href="../iterators.html#hikari.iterators.LazyIterator.count"
>count</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="enumerate -- Enumerate the paginated results lazily …" href="../iterators.html#hikari.iterators.LazyIterator.enumerate"
>enumerate</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="filter -- Filter the items by one or more conditions …" href="../event_stream.html#hikari.event_stream.EventStream.filter"
>filter</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="flat_map -- Perform a flat mapping operation …" href="../iterators.html#hikari.iterators.LazyIterator.flat_map"
>flat_map</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="for_each -- Pass each value to a given consumer immediately." href="../iterators.html#hikari.iterators.LazyIterator.for_each"
>for_each</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="last -- Return the last element of this iterator only …" href="../iterators.html#hikari.iterators.LazyIterator.last"
>last</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="limit -- Limit the number of items you receive from this async iterator …" href="../iterators.html#hikari.iterators.LazyIterator.limit"
>limit</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="map -- Map the values to a different value …" href="../iterators.html#hikari.iterators.LazyIterator.map"
>map</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="next -- Return the next element of this iterator only …" href="../iterators.html#hikari.iterators.LazyIterator.next"
>next</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="open -- Mark this streamer as opened to let it start receiving and queueing events …" href="#hikari.impl.stateful_guild_chunker.ChunkStream.open"
>open</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="reversed -- Return a lazy iterator of the remainder of this iterator's values reversed …" href="../iterators.html#hikari.iterators.LazyIterator.reversed"
>reversed</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="skip -- Drop the given number of items, then yield anything after …" href="../iterators.html#hikari.iterators.LazyIterator.skip"
>skip</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="skip_until -- Discard items while all conditions are False …" href="../iterators.html#hikari.iterators.LazyIterator.skip_until"
>skip_until</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="skip_while -- Discard items while all conditions are True …" href="../iterators.html#hikari.iterators.LazyIterator.skip_while"
>skip_while</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="sort -- Collect all results, then sort the collection before returning it." href="../iterators.html#hikari.iterators.LazyIterator.sort"
>sort</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="take_until -- Return each item until any conditions pass or the end is reached …" href="../iterators.html#hikari.iterators.LazyIterator.take_until"
>take_until</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="take_while -- Return each item until any conditions fail or the end is reached …" href="../iterators.html#hikari.iterators.LazyIterator.take_while"
>take_while</a>
</li>
<br />
</ul>
</li>
<li class="monospaced">
<small class='text-muted'><em><abbr title='A standard Python type.'>class</abbr></em></small> <a title="StatefulGuildChunkerImpl -- Guild chunker implementation …" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl"
>StatefulGuildChunkerImpl</a>
<ul class="list-unstyled nested text-truncate">
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="close -- Close the guild chunker." href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.close"
>close</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="consume_chunk_event -- Listen to chunk events …" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.consume_chunk_event"
>consume_chunk_event</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="fetch_members_for_guild -- Request for a guild chunk …" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.fetch_members_for_guild"
>fetch_members_for_guild</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="get_request_status -- Return the status of a request …" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.get_request_status"
>get_request_status</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="list_requests_for_guild -- List the statuses of requests made for a specific guild …" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.list_requests_for_guild"
>list_requests_for_guild</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="list_requests_for_shard -- List the statuses of requests made for a specific shard …" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.list_requests_for_shard"
>list_requests_for_shard</a>
</li>
<li class="text-truncate monospaced">
<small class='text-muted'><em><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr></em></small> <a title="request_guild_members -- Request for a guild chunk …" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.request_guild_members"
>request_guild_members</a>
</li>
<br />
</ul>
</li>
</ul>
<!--</nav>-->
</div>
<div class="col-xs-12 col-lg-7 col-xl-8">
<div class="row">
<div class="col module-source">
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L0-L319" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
# cython: language_level=3
# Copyright (c) 2020 Nekokatt
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the &#34;Software&#34;), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED &#34;AS IS&#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.
&#34;&#34;&#34;Basic implementation of a guild chunker.&#34;&#34;&#34;

from __future__ import annotations

__all__: typing.List[str] = [&#34;StatefulGuildChunkerImpl&#34;, &#34;ChunkStream&#34;]

import asyncio
import base64
import copy
import random
import typing

import attr

from hikari import event_stream
from hikari import intents as intents_
from hikari import snowflakes
from hikari import undefined
from hikari.api import chunker
from hikari.events import shard_events
from hikari.internal import attr_extensions
from hikari.internal import collections
from hikari.internal import time

if typing.TYPE_CHECKING:
    import datetime

    from hikari import guilds
    from hikari import traits
    from hikari import users as users_
    from hikari.api import shard as gateway_shard

EXPIRY_TIME: typing.Final[int] = 5000
&#34;&#34;&#34;How long a chunk event should wait until it&#39;s considered expired in miliseconds.&#34;&#34;&#34;


def _random_nonce() -&gt; str:
    head = time.monotonic_ns().to_bytes(8, &#34;big&#34;)
    tail = random.getrandbits(92).to_bytes(12, &#34;big&#34;)
    return base64.b64encode(head + tail).decode(&#34;ascii&#34;)


class ChunkStream(event_stream.EventStream[shard_events.MemberChunkEvent]):
    &#34;&#34;&#34;A specialised event stream used for triggering and streaming chunk events.

    See Also
    --------
    Event Stream: `hikari.utilities.event_stream.EventStream`
    &#34;&#34;&#34;

    __slots__: typing.Sequence[str] = (
        &#34;_guild_id&#34;,
        &#34;_include_presences&#34;,
        &#34;_limit&#34;,
        &#34;_missing_chunks&#34;,
        &#34;_nonce&#34;,
        &#34;_query&#34;,
        &#34;_users&#34;,
    )

    def __init__(
        self,
        app: traits.BotAware,
        guild_id: snowflakes.Snowflake,
        *,
        timeout: typing.Union[int, float, None],
        limit: typing.Optional[int] = None,
        include_presences: undefined.UndefinedOr[bool] = undefined.UNDEFINED,
        query_limit: int = 0,
        query: str = &#34;&#34;,
        users: undefined.UndefinedOr[typing.Sequence[snowflakes.SnowflakeishOr[users_.User]]] = undefined.UNDEFINED,
    ) -&gt; None:
        super().__init__(app=app, event_type=shard_events.MemberChunkEvent, limit=limit, timeout=timeout)
        self._guild_id = guild_id
        self._include_presences = include_presences
        self._limit = query_limit
        self._missing_chunks: typing.Optional[typing.MutableSequence[int]] = None
        self._nonce = time.uuid()
        self._query = query
        self._users = users
        self.filter(lambda event: event.nonce == self._nonce)

    async def _listener(self, event: shard_events.MemberChunkEvent) -&gt; None:
        if not self._filters(event):
            return

        if self._missing_chunks is None:
            self._missing_chunks = list(range(event.chunk_count))

        self._missing_chunks.remove(event.chunk_index)

        try:
            self._queue.put_nowait(event)
        except asyncio.QueueFull:
            pass

        if not self._missing_chunks:
            # While it is tempting to just close the stream here, that&#39;d lead to a type error being
            # raised the next time they try to iterate over it.
            assert self._registered_listener is not None
            self._app.dispatcher.unsubscribe(shard_events.MemberChunkEvent, self._registered_listener)

    async def __anext__(self) -&gt; shard_events.MemberChunkEvent:
        if not self._active:
            raise TypeError(&#34;stream must be started with `await with` before entering it&#34;)

        if self._queue.empty() and not self._missing_chunks and self._missing_chunks is not None:
            raise StopAsyncIteration from None

        try:
            return await asyncio.wait_for(self._queue.get(), timeout=self._timeout)
        except asyncio.TimeoutError:
            raise StopAsyncIteration from None

    async def open(self) -&gt; None:
        # as super().open will possibly flip self.started, we want to have its state when this was originally called.
        started = self._active
        await super().open()

        if not started:
            shard_id = snowflakes.calculate_shard_id(self._app, self._guild_id)
            await self._app.shards[shard_id].request_guild_members(
                guild=self._guild_id,
                include_presences=self._include_presences,
                query=self._query,
                limit=self._limit,
                users=self._users,
                nonce=self._nonce,
            )


@attr.s(init=True, kw_only=True, hash=False, eq=True, slots=True, weakref_slot=False)
class _TrackedRequests:
    &#34;&#34;&#34;`hikari.api.chunker.RequestInformation` implementation.&#34;&#34;&#34;

    __slots__: typing.Sequence[str]

    average_chunk_size: typing.Optional[int] = attr.ib(default=None)
    chunk_count: typing.Optional[int] = attr.ib(default=None)
    guild_id: snowflakes.Snowflake = attr.ib()
    last_received: typing.Optional[datetime.datetime] = attr.ib(default=None)
    _mono_last_received: typing.Optional[int] = attr.ib(default=None)
    missing_chunk_indexes: typing.Optional[typing.MutableSequence[int]] = attr.ib(default=None)
    nonce: str = attr.ib()
    not_found_ids: typing.MutableSequence[snowflakes.Snowflake] = attr.ib(factory=list)

    def __copy__(self) -&gt; _TrackedRequests:
        chunks = attr_extensions.copy_attrs(self)
        chunks.missing_chunk_indexes = (
            list(self.missing_chunk_indexes) if self.missing_chunk_indexes is not None else None
        )
        chunks.not_found_ids = list(self.not_found_ids)
        return chunks

    @property
    def is_complete(self) -&gt; bool:
        if self.received_chunks == self.chunk_count:
            return True

        return self._mono_last_received is not None and time.monotonic_ns() - self._mono_last_received &gt; EXPIRY_TIME

    @property
    def received_chunks(self) -&gt; int:
        if self.chunk_count is None or self.missing_chunk_indexes is None:
            return 0

        return self.chunk_count - len(self.missing_chunk_indexes)

    def update(self, event: shard_events.MemberChunkEvent) -&gt; None:
        if self.missing_chunk_indexes is None:
            self.average_chunk_size = len(event.members)
            self.chunk_count = event.chunk_count
            self.missing_chunk_indexes = list(range(event.chunk_count))

        self.not_found_ids.extend(event.not_found)
        self.missing_chunk_indexes.remove(event.chunk_index)
        self._mono_last_received = time.monotonic_ns()
        self.last_received = time.utc_datetime()


class StatefulGuildChunkerImpl(chunker.GuildChunker):
    &#34;&#34;&#34;Guild chunker implementation.

    Parameters
    ----------
    app : hikari.traits.BotAware
        The object of the bot aware app this is bound to.
    limit : builtins.int
        The maximum amount of requests that this chunker should store information
        about for each shard.
    &#34;&#34;&#34;

    __slots__: typing.Sequence[str] = (&#34;_app&#34;, &#34;_limit&#34;, &#34;_tracked&#34;)

    def __init__(self, app: traits.BotAware, limit: int = 200) -&gt; None:
        self._app = app
        self._limit = limit
        self._tracked: typing.MutableMapping[int, collections.LimitedCapacityCacheMap[str, _TrackedRequests]] = {}

    def _default_include_presences(
        self, guild_id: snowflakes.Snowflake, include_presences: undefined.UndefinedOr[bool]
    ) -&gt; bool:
        if include_presences is not undefined.UNDEFINED:
            return include_presences

        shard_id = snowflakes.calculate_shard_id(self._app, guild_id)
        shard = self._app.shards[shard_id]
        return bool(shard.intents &amp; intents_.Intents.GUILD_PRESENCES)

    def fetch_members_for_guild(
        self,
        guild: snowflakes.SnowflakeishOr[guilds.GatewayGuild],
        *,
        timeout: typing.Union[int, float, None],
        limit: typing.Optional[int] = None,
        include_presences: undefined.UndefinedOr[bool] = undefined.UNDEFINED,
        query_limit: int = 0,
        query: str = &#34;&#34;,
        users: undefined.UndefinedOr[typing.Sequence[snowflakes.SnowflakeishOr[users_.User]]] = undefined.UNDEFINED,
    ) -&gt; event_stream.Streamer[shard_events.MemberChunkEvent]:
        guild_id = snowflakes.Snowflake(guild)
        return ChunkStream(
            app=self._app,
            guild_id=guild_id,
            timeout=timeout,
            limit=limit,
            include_presences=self._default_include_presences(guild_id, include_presences),
            query_limit=query_limit,
            query=query,
            users=users,
        )

    async def get_request_status(self, nonce: str, /) -&gt; typing.Optional[chunker.RequestInformation]:
        try:
            shard_id = int(nonce.split(&#34;.&#34;, 1)[0])
        except ValueError:
            return None
        else:
            return copy.copy(self._tracked[shard_id].get(nonce)) if shard_id in self._tracked else None

    async def list_requests_for_shard(
        self, shard: typing.Union[gateway_shard.GatewayShard, int], /
    ) -&gt; typing.Sequence[chunker.RequestInformation]:
        shard_id = shard if isinstance(shard, int) else shard.id

        if shard_id not in self._tracked:
            return ()

        return tuple(copy.copy(chunk) for chunk in self._tracked[shard_id].copy().values())

    async def list_requests_for_guild(
        self, guild: snowflakes.SnowflakeishOr[guilds.GatewayGuild], /
    ) -&gt; typing.Sequence[chunker.RequestInformation]:
        guild_id = snowflakes.Snowflake(guild)
        shard_id = snowflakes.calculate_shard_id(self._app, guild_id)
        if shard_id not in self._tracked:
            return ()

        return tuple(copy.copy(event) for event in self._tracked[shard_id].values() if event.guild_id == guild_id)

    async def consume_chunk_event(self, event: shard_events.MemberChunkEvent, /) -&gt; None:
        if (
            event.shard.id not in self._tracked
            or event.nonce is None
            or event.nonce not in self._tracked[event.shard.id]
        ):
            return

        self._tracked[event.shard.id][event.nonce].update(event)

    async def request_guild_members(
        self,
        guild: snowflakes.SnowflakeishOr[guilds.GatewayGuild],
        /,
        include_presences: undefined.UndefinedOr[bool] = undefined.UNDEFINED,
        limit: int = 0,
        query: str = &#34;&#34;,
        users: undefined.UndefinedOr[typing.Sequence[snowflakes.SnowflakeishOr[users_.User]]] = undefined.UNDEFINED,
    ) -&gt; str:
        guild_id = snowflakes.Snowflake(guild)
        shard_id = snowflakes.calculate_shard_id(self._app, guild_id)
        nonce = f&#34;{shard_id}.{_random_nonce()}&#34;
        if shard_id not in self._tracked:
            self._tracked[shard_id] = collections.LimitedCapacityCacheMap(limit=self._limit)

        tracker = _TrackedRequests(guild_id=guild_id, nonce=nonce)
        self._tracked[shard_id][nonce] = tracker
        await self._app.shards[shard_id].request_guild_members(
            guild=guild_id,
            include_presences=self._default_include_presences(guild_id, include_presences),
            limit=limit,
            nonce=nonce,
            query=query,
            users=users,
        )
        return nonce

    async def close(self) -&gt; None:
        return None</code></pre>
</details>
</div>
</div>
<h2 id="class-heading">Classes</h2>
<section class="definition">
<dl class="no-nest root">
<dt>
<h4><small class='text-muted'><em><abbr title='A standard Python type.'>class</abbr></em></small> <a title="ChunkStream -- A specialised event stream used for triggering and streaming chunk events …" href="#hikari.impl.stateful_guild_chunker.ChunkStream"
>ChunkStream</a></h4>
</dt>
<dd>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream" class="hljs python"><abbr title='A standard Python type.'>class</abbr> ChunkStream (
    app: <a href='../traits.html#hikari.traits.BotAware'>traits.BotAware</a>,
    guild_id: <a href='../snowflakes.html#hikari.snowflakes.Snowflake'>snowflakes.Snowflake</a>,
    *,
    timeout: <a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/functions.html#int'>int</a>, <a href='https://docs.python.org/3/library/functions.html#float'>float</a>, <a href='https://docs.python.org/3/library/constants.html#None'>None</a>],
    limit: <a href='https://docs.python.org/3/library/typing.html#typing.Optional'>Optional</a>[<a href='https://docs.python.org/3/library/functions.html#int'>int</a>] = None,
    include_presences: <a href='../undefined.html#hikari.undefined.UndefinedOr'>undefined.UndefinedOr</a>[<a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>] = UNDEFINED,
    query_limit: <a href='https://docs.python.org/3/library/functions.html#int'>int</a> = 0,
    query: <a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a> = '',
    users: <a href='../undefined.html#hikari.undefined.UndefinedOr'>undefined.UndefinedOr</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[<a href='../snowflakes.html#hikari.snowflakes.SnowflakeishOr'>snowflakes.SnowflakeishOr</a>[<a href='../users.html#hikari.users.User'>users_.User</a>]]] = UNDEFINED,
): ...</code></pre>
<p>A specialised event stream used for triggering and streaming chunk events.</p>
<h2 id="see-also">See Also</h2>
<p><code>Event Stream: </code>hikari.utilities.event_stream.EventStream``</p>
<div class="sep"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L64-L150" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">class ChunkStream(event_stream.EventStream[shard_events.MemberChunkEvent]):
    &#34;&#34;&#34;A specialised event stream used for triggering and streaming chunk events.

    See Also
    --------
    Event Stream: `hikari.utilities.event_stream.EventStream`
    &#34;&#34;&#34;

    __slots__: typing.Sequence[str] = (
        &#34;_guild_id&#34;,
        &#34;_include_presences&#34;,
        &#34;_limit&#34;,
        &#34;_missing_chunks&#34;,
        &#34;_nonce&#34;,
        &#34;_query&#34;,
        &#34;_users&#34;,
    )

    def __init__(
        self,
        app: traits.BotAware,
        guild_id: snowflakes.Snowflake,
        *,
        timeout: typing.Union[int, float, None],
        limit: typing.Optional[int] = None,
        include_presences: undefined.UndefinedOr[bool] = undefined.UNDEFINED,
        query_limit: int = 0,
        query: str = &#34;&#34;,
        users: undefined.UndefinedOr[typing.Sequence[snowflakes.SnowflakeishOr[users_.User]]] = undefined.UNDEFINED,
    ) -&gt; None:
        super().__init__(app=app, event_type=shard_events.MemberChunkEvent, limit=limit, timeout=timeout)
        self._guild_id = guild_id
        self._include_presences = include_presences
        self._limit = query_limit
        self._missing_chunks: typing.Optional[typing.MutableSequence[int]] = None
        self._nonce = time.uuid()
        self._query = query
        self._users = users
        self.filter(lambda event: event.nonce == self._nonce)

    async def _listener(self, event: shard_events.MemberChunkEvent) -&gt; None:
        if not self._filters(event):
            return

        if self._missing_chunks is None:
            self._missing_chunks = list(range(event.chunk_count))

        self._missing_chunks.remove(event.chunk_index)

        try:
            self._queue.put_nowait(event)
        except asyncio.QueueFull:
            pass

        if not self._missing_chunks:
            # While it is tempting to just close the stream here, that&#39;d lead to a type error being
            # raised the next time they try to iterate over it.
            assert self._registered_listener is not None
            self._app.dispatcher.unsubscribe(shard_events.MemberChunkEvent, self._registered_listener)

    async def __anext__(self) -&gt; shard_events.MemberChunkEvent:
        if not self._active:
            raise TypeError(&#34;stream must be started with `await with` before entering it&#34;)

        if self._queue.empty() and not self._missing_chunks and self._missing_chunks is not None:
            raise StopAsyncIteration from None

        try:
            return await asyncio.wait_for(self._queue.get(), timeout=self._timeout)
        except asyncio.TimeoutError:
            raise StopAsyncIteration from None

    async def open(self) -&gt; None:
        # as super().open will possibly flip self.started, we want to have its state when this was originally called.
        started = self._active
        await super().open()

        if not started:
            shard_id = snowflakes.calculate_shard_id(self._app, self._guild_id)
            await self._app.shards[shard_id].request_guild_members(
                guild=self._guild_id,
                include_presences=self._include_presences,
                query=self._query,
                limit=self._limit,
                users=self._users,
                nonce=self._nonce,
            )</code></pre>
</details>
<div class="sep"></div>
<h5>Method resolution order</h5>
<dl>
<dt class="nested"><small class='text-muted'><em><abbr title='A standard Python type.'>class</abbr></em></small> <a title="ChunkStream -- A specialised event stream used for triggering and streaming chunk events …" href="#hikari.impl.stateful_guild_chunker.ChunkStream"
>ChunkStream</a></dt>
<dd class="nested"><em class="text-muted">That's this class!</em></dd>
<dt class="nested"><small class='text-muted'><em><abbr title='A standard Python type.'>class</abbr></em></small> <a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></dt>
<dd class="nested"><p>An implementation of an event <code>Streamer</code> class …</p></dd>
<dt class="nested"><small class='text-muted'><em><abbr title='An abstract base class which may have abstract methods and abstract properties.'>abstract</abbr> <abbr title='A standard Python type.'>class</abbr></em></small> <a title="Streamer -- A base abstract class for all event streamers …" href="../event_stream.html#hikari.event_stream.Streamer"
>Streamer</a></dt>
<dd class="nested"><p>A base abstract class for all event streamers …</p></dd>
<dt class="nested"><small class='text-muted'><em><abbr title='An abstract base class which may have abstract methods and abstract properties.'>abstract</abbr> <abbr title='A standard Python type.'>class</abbr></em></small> <a title="LazyIterator -- A set of results that are fetched asynchronously from the API as needed …" href="../iterators.html#hikari.iterators.LazyIterator"
>LazyIterator</a></dt>
<dd class="nested"><p>A set of results that are fetched asynchronously from the API as needed …</p></dd>
<dt class="nested"><small class='text-muted'><em><abbr title='Anything that is external to this library.'>extern</abbr> class</em></small> <a title="typing.Generic -- Abstract base class for generic types …" href="https://docs.python.org/3/library/typing.html#typing.Generic"
>Generic</a></dt>
<dd class="nested"><p>Abstract base class for generic types …</p></dd>
<dt class="nested"><small class='text-muted'><em><abbr title='Anything that is external to this library.'>extern</abbr> class</em></small> <a title="abc.ABC -- Helper class that provides a standard way to create an ABC using
inheritance." href="https://docs.python.org/3/library/abc.html#abc.ABC"
>abc.ABC</a></dt>
<dd class="nested"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p></dd>
</dl>
<div class="sep"></div>
<h5>Methods</h5>
<dl>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.awaiting" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="awaiting" href="../iterators.html#hikari.iterators.LazyIterator.awaiting" id="hikari.impl.stateful_guild_chunker.ChunkStream.awaiting">awaiting</a>(
    window_size: <a href='https://docs.python.org/3/library/functions.html#int'>int</a> = 10,
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="awaiting -- Await each item concurrently in a fixed size window …" href="../iterators.html#hikari.iterators.LazyIterator.awaiting"
>awaiting</a></code>
</p>
<p>Await each item concurrently in a fixed size window.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>window_size</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/functions.html#int'>int</a></code></dt>
<dd>The window size of how many tasks to await at once. You can set this
to <code>0</code> to await everything at once, but see the below warning.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[ValueT]</code></dt>
<dd>The new lazy iterator to return.</dd>
</dl>
<div class="alert alert-warning">
<p class="admonition-title">Warning</p>
<p>Setting a large window size, or setting it to 0 to await everything
is a dangerous thing to do if you are making API calls. Some
endpoints will get ratelimited and cause a backup of waiting
tasks, others may begin to spam global rate limits instead
(the <code>fetch_user</code> endpoint seems to be notorious for doing this).</p>
</div>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p>This call assumes that the iterator contains awaitable values as
input. MyPy cannot detect this nicely, so any cast is forced
internally.</p>
<p>If the item is not awaitable, you will receive a
<code><a href='https://docs.python.org/3/library/exceptions.html#TypeError'>TypeError</a></code> instead.</p>
<p>You have been warned. You cannot escape the ways of the duck type
young grasshopper.</p>
</div>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.chunk" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="chunk" href="../iterators.html#hikari.iterators.LazyIterator.chunk" id="hikari.impl.stateful_guild_chunker.ChunkStream.chunk">chunk</a>(
    chunk_size: <a href='https://docs.python.org/3/library/functions.html#int'>int</a>,
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[~<a href='#hikari.iterators.ValueT'>ValueT</a>]]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="chunk -- Return results in chunks of up to `chunk_size` amount of entries …" href="../iterators.html#hikari.iterators.LazyIterator.chunk"
>chunk</a></code>
</p>
<p>Return results in chunks of up to <code>chunk_size</code> amount of entries.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>chunk_size</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/functions.html#int'>int</a></code></dt>
<dd>The limit for how many results should be returned in each chunk.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[<a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[ValueT]]</code></dt>
<dd><code>LazyIterator</code> that emits each chunked sequence.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.close" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="close" href="../event_stream.html#hikari.event_stream.EventStream.close" id="hikari.impl.stateful_guild_chunker.ChunkStream.close">close</a>() -> None: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="close -- Mark this streamer as closed to stop it from queueing and receiving events …" href="../event_stream.html#hikari.event_stream.EventStream.close"
>close</a></code>
</p>
<p>Mark this streamer as closed to stop it from queueing and receiving events.</p>
<p>If called on an already closed streamer then this will do nothing.</p>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p><code>async with streamer</code> may be used as a short-cut for opening and
closing a streamer.</p>
</div>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.collect" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="collect" href="../iterators.html#hikari.iterators.LazyIterator.collect" id="hikari.impl.stateful_guild_chunker.ChunkStream.collect">collect</a>(
    collector: <a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[<a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[<a href='#hikari.iterators.ValueT'>ValueT</a>]], <a href='https://docs.python.org/3/library/typing.html#typing.Collection'>Collection</a>[<a href='#hikari.iterators.ValueT'>ValueT</a>]],
) -> Collection[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="collect -- Collect the results into a given type and return it …" href="../iterators.html#hikari.iterators.LazyIterator.collect"
>collect</a></code>
</p>
<p>Collect the results into a given type and return it.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>collector</code></strong></dt>
<dd>A function that consumes a sequence of values and returns a
collection.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.count" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="count" href="../iterators.html#hikari.iterators.LazyIterator.count" id="hikari.impl.stateful_guild_chunker.ChunkStream.count">count</a>() -> <a href='https://docs.python.org/3/library/functions.html#int'>int</a>: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="count -- Count the number of results …" href="../iterators.html#hikari.iterators.LazyIterator.count"
>count</a></code>
</p>
<p>Count the number of results.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code><a href='https://docs.python.org/3/library/functions.html#int'>int</a></code></dt>
<dd>Number of results found.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.enumerate" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="enumerate" href="../iterators.html#hikari.iterators.LazyIterator.enumerate" id="hikari.impl.stateful_guild_chunker.ChunkStream.enumerate">enumerate</a>(
    *,
    start: <a href='https://docs.python.org/3/library/functions.html#int'>int</a> = 0,
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/functions.html#int'>int</a>, ~<a href='#hikari.iterators.ValueT'>ValueT</a>]]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="enumerate -- Enumerate the paginated results lazily …" href="../iterators.html#hikari.iterators.LazyIterator.enumerate"
>enumerate</a></code>
</p>
<p>Enumerate the paginated results lazily.</p>
<p>This behaves as an asyncio-friendly version of <code><a href='https://docs.python.org/3/library/functions.html#enumerate'>enumerate</a></code>
which uses much less memory than collecting all the results first and
calling <code><a href='https://docs.python.org/3/library/functions.html#enumerate'>enumerate</a></code> across them.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>start</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/functions.html#int'>int</a></code></dt>
<dd>Optional int to start at. If omitted, this is <code>0</code>.</dd>
</dl>
<h2 id="examples">Examples</h2>
<pre><code>&gt;&gt;&gt; async for i, item in paginated_results.enumerate():
...    print(i, item)
(0, foo)
(1, bar)
(2, baz)
(3, bork)
(4, qux)

&gt;&gt;&gt; async for i, item in paginated_results.enumerate(start=9):
...    print(i, item)
(9, foo)
(10, bar)
(11, baz)
(12, bork)
(13, qux)

&gt;&gt;&gt; async for i, item in paginated_results.enumerate(start=9).limit(3):
...    print(i, item)
(9, foo)
(10, bar)
(11, baz)
</code></pre>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[<a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/functions.html#int'>int</a>, T]]</code></dt>
<dd>A paginated results view that asynchronously yields an increasing
counter in a tuple with each result, lazily.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.filter" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="filter" href="../event_stream.html#hikari.event_stream.EventStream.filter" id="hikari.impl.stateful_guild_chunker.ChunkStream.filter">filter</a>(
    *predicates: <a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[EventT], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>]],
    **attrs: <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>,
) -> Union[<a href='#hikari.event_stream.EventStream'>EventStream</a>[~EventT], <a href='iterators.html#hikari.iterators.LazyIterator'>LazyIterator</a>[~EventT]]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="filter -- Filter the items by one or more conditions …" href="../event_stream.html#hikari.event_stream.EventStream.filter"
>filter</a></code>
</p>
<p>Filter the items by one or more conditions.</p>
<p>Each condition is treated as a predicate, being called with each item
that this iterator would return when it is requested.</p>
<p>All conditions must evaluate to <code><a href='https://docs.python.org/3/library/constants.html#True'>True</a></code> for the item to be
returned. If this is not met, then the item is discared and ignored,
the next matching item will be returned instead, if there is one.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>*predicates</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[ValueT], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>]]</code></dt>
<dd>Predicates to invoke. These are functions that take a value and
return <code><a href='https://docs.python.org/3/library/constants.html#True'>True</a></code> if it is of interest, or <code><a href='https://docs.python.org/3/library/constants.html#False'>False</a></code>
otherwise. These may instead include 2-<code><a href='https://docs.python.org/3/library/stdtypes.html#tuple'>tuple</a></code> objects
consisting of a <code><a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a></code> attribute name (nested attributes
are referred to using the <code>.</code> operator), and values to compare for
equality. This allows you to specify conditions such as
<code>members.filter(("user.bot", <a href='https://docs.python.org/3/library/constants.html#True'>True</a>))</code>.</dd>
<dt><strong><code>**attrs</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a></code></dt>
<dd>Alternative to passing 2-tuples. Cannot specify nested attributes
using this method.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[ValueT]</code></dt>
<dd><code>LazyIterator</code> that only emits values where all conditions are
matched.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.flat_map" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="flat_map" href="../iterators.html#hikari.iterators.LazyIterator.flat_map" id="hikari.impl.stateful_guild_chunker.ChunkStream.flat_map">flat_map</a>(
    flattener: _FlattenerT[<a href='#hikari.iterators.ValueT'>ValueT</a>, <a href='#hikari.iterators.AnotherValueT'>AnotherValueT</a>],
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.AnotherValueT'>AnotherValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="flat_map -- Perform a flat mapping operation …" href="../iterators.html#hikari.iterators.LazyIterator.flat_map"
>flat_map</a></code>
</p>
<p>Perform a flat mapping operation.</p>
<p>This will pass each item in the iterator to the given <code><a href='https://docs.python.org/3/reference/compound_stmts.html#function'>function</a></code>
parameter, expecting a new <code><a href='https://docs.python.org/3/library/typing.html#typing.Iterable'>Iterable</a></code> or <code><a href='https://docs.python.org/3/library/typing.html#typing.AsyncIterator'>AsyncIterator</a></code>
to be returned as the result. This means you can map to a new
<code>LazyIterator</code>, <code><a href='https://docs.python.org/3/library/typing.html#typing.AsyncIterator'>AsyncIterator</a></code>, <code><a href='https://docs.python.org/3/library/typing.html#typing.Iterable'>Iterable</a></code>,
async generator, or generator.</p>
<p>Remember that <code><a href='https://docs.python.org/3/library/typing.html#typing.Iterator'>Iterator</a></code> implicitly provides <code><a href='https://docs.python.org/3/library/typing.html#typing.Iterable'>Iterable</a></code>
compatibility.</p>
<p>This is used to provide lazy conversions, and can be used to implement
reactive-like pipelines if desired.</p>
<p>All results are combined into one large lazy iterator and yielded
lazily.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>flattener</code></strong></dt>
<dd>A function that returns either an async iterator or iterator of
new values. Could be an attribute name instead.</dd>
</dl>
<h2 id="example">Example</h2>
<p>The following example generates a distinct collection of all mentioned
users in the given channel from the past 500 messages.</p>
<pre><code class="language-py">def iter_mentioned_users(message: hikari.Message) -&gt; typing.Iterable[Snowflake]:
    for match in re.findall(r&quot;&lt;@!?(\d+)&gt;&quot;, message.content):
        yield Snowflake(match)

mentioned_users = await (
    channel
    .history()
    .limit(500)
    .map(&quot;.content&quot;)
    .flat_map(iter_mentioned_users)
    .distinct()
)
</code></pre>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[AnotherValueT]</code></dt>
<dd>The new lazy iterator to return.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.for_each" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="for_each" href="../iterators.html#hikari.iterators.LazyIterator.for_each" id="hikari.impl.stateful_guild_chunker.ChunkStream.for_each">for_each</a>(
    consumer: <a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[<a href='#hikari.iterators.ValueT'>ValueT</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>],
) -> None: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="for_each -- Pass each value to a given consumer immediately." href="../iterators.html#hikari.iterators.LazyIterator.for_each"
>for_each</a></code>
</p>
<p>Pass each value to a given consumer immediately.</p>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.last" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="last" href="../iterators.html#hikari.iterators.LazyIterator.last" id="hikari.impl.stateful_guild_chunker.ChunkStream.last">last</a>() -> ~<a href='#hikari.iterators.ValueT'>ValueT</a>: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="last -- Return the last element of this iterator only …" href="../iterators.html#hikari.iterators.LazyIterator.last"
>last</a></code>
</p>
<p>Return the last element of this iterator only.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>ValueT</code></dt>
<dd>The last result.</dd>
</dl>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p>This method will consume the whole iterator if run.</p>
</div>
<h2 id="raises">Raises</h2>
<dl>
<dt><code><a href='https://docs.python.org/3/library/exceptions.html#LookupError'>LookupError</a></code></dt>
<dd>If no result exists.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.limit" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="limit" href="../iterators.html#hikari.iterators.LazyIterator.limit" id="hikari.impl.stateful_guild_chunker.ChunkStream.limit">limit</a>(
    limit: <a href='https://docs.python.org/3/library/functions.html#int'>int</a>,
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="limit -- Limit the number of items you receive from this async iterator …" href="../iterators.html#hikari.iterators.LazyIterator.limit"
>limit</a></code>
</p>
<p>Limit the number of items you receive from this async iterator.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>limit</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/functions.html#int'>int</a></code></dt>
<dd>The number of items to get. This must be greater than zero.</dd>
</dl>
<h2 id="examples">Examples</h2>
<pre><code>&gt;&gt;&gt; async for item in paginated_results.limit(3):
...     print(item)
</code></pre>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[ValueT]</code></dt>
<dd>A paginated results view that asynchronously yields a maximum
of the given number of items before completing.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.map" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="map" href="../iterators.html#hikari.iterators.LazyIterator.map" id="hikari.impl.stateful_guild_chunker.ChunkStream.map">map</a>(
    transformation: <a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[<a href='#hikari.iterators.ValueT'>ValueT</a>], <a href='#hikari.iterators.AnotherValueT'>AnotherValueT</a>], <a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>],
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.AnotherValueT'>AnotherValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="map -- Map the values to a different value …" href="../iterators.html#hikari.iterators.LazyIterator.map"
>map</a></code>
</p>
<p>Map the values to a different value.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>transformation</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[ValueT], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>], <a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>]</code></dt>
<dd>The function to use to map the attribute. This may alternatively
be a string attribute name to replace the input value with. You
can provide nested attributes using the <code>.</code> operator.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[AnotherValueT]</code></dt>
<dd><code>LazyIterator</code> that maps each value to another value.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.next" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="next" href="../iterators.html#hikari.iterators.LazyIterator.next" id="hikari.impl.stateful_guild_chunker.ChunkStream.next">next</a>() -> ~<a href='#hikari.iterators.ValueT'>ValueT</a>: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="next -- Return the next element of this iterator only …" href="../iterators.html#hikari.iterators.LazyIterator.next"
>next</a></code>
</p>
<p>Return the next element of this iterator only.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>ValueT</code></dt>
<dd>The next result.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code><a href='https://docs.python.org/3/library/exceptions.html#LookupError'>LookupError</a></code></dt>
<dd>If no more results exist.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.open" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="open" href="#hikari.impl.stateful_guild_chunker.ChunkStream.open" id="hikari.impl.stateful_guild_chunker.ChunkStream.open">open</a>() -> None: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="open -- Mark this streamer as opened to let it start receiving and queueing events …" href="../event_stream.html#hikari.event_stream.EventStream.open"
>open</a></code>
</p>
<p>Mark this streamer as opened to let it start receiving and queueing events.</p>
<p>If called on an already started streamer then this will do nothing.</p>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p><code>async with streamer</code> may be used as a short-cut for opening and
closing a stream.</p>
</div>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L136-L150" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">async def open(self) -&gt; None:
    # as super().open will possibly flip self.started, we want to have its state when this was originally called.
    started = self._active
    await super().open()

    if not started:
        shard_id = snowflakes.calculate_shard_id(self._app, self._guild_id)
        await self._app.shards[shard_id].request_guild_members(
            guild=self._guild_id,
            include_presences=self._include_presences,
            query=self._query,
            limit=self._limit,
            users=self._users,
            nonce=self._nonce,
        )</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.reversed" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="reversed" href="../iterators.html#hikari.iterators.LazyIterator.reversed" id="hikari.impl.stateful_guild_chunker.ChunkStream.reversed">reversed</a>() -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="reversed -- Return a lazy iterator of the remainder of this iterator's values reversed …" href="../iterators.html#hikari.iterators.LazyIterator.reversed"
>reversed</a></code>
</p>
<p>Return a lazy iterator of the remainder of this iterator's values reversed.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[ValueT]</code></dt>
<dd>The lazy iterator of this iterator's remaining values reversed.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.skip" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="skip" href="../iterators.html#hikari.iterators.LazyIterator.skip" id="hikari.impl.stateful_guild_chunker.ChunkStream.skip">skip</a>(
    number: <a href='https://docs.python.org/3/library/functions.html#int'>int</a>,
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="skip -- Drop the given number of items, then yield anything after …" href="../iterators.html#hikari.iterators.LazyIterator.skip"
>skip</a></code>
</p>
<p>Drop the given number of items, then yield anything after.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>number</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/functions.html#int'>int</a></code></dt>
<dd>The max number of items to drop before any items are yielded.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[ValueT]</code></dt>
<dd>A paginated results view that asynchronously yields all items
AFTER the given number of items are discarded first.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.skip_until" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="skip_until" href="../iterators.html#hikari.iterators.LazyIterator.skip_until" id="hikari.impl.stateful_guild_chunker.ChunkStream.skip_until">skip_until</a>(
    *predicates: <a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[<a href='#hikari.iterators.ValueT'>ValueT</a>], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>]],
    **attrs: <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>,
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="skip_until -- Discard items while all conditions are False …" href="../iterators.html#hikari.iterators.LazyIterator.skip_until"
>skip_until</a></code>
</p>
<p>Discard items while all conditions are False.</p>
<p>Items after this will be yielded as normal.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>*predicates</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[ValueT], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>]]</code></dt>
<dd>Predicates to invoke. These are functions that take a value and
return <code><a href='https://docs.python.org/3/library/constants.html#True'>True</a></code> if it is of interest, or <code><a href='https://docs.python.org/3/library/constants.html#False'>False</a></code>
otherwise. These may instead include 2-<code><a href='https://docs.python.org/3/library/stdtypes.html#tuple'>tuple</a></code> objects
consisting of a <code><a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a></code> attribute name (nested attributes are
referred to using the <code>.</code> operator), and values to compare for
equality. This allows you to specify conditions such as
<code>members.skip_until(("user.bot", <a href='https://docs.python.org/3/library/constants.html#True'>True</a>))</code>.</dd>
<dt><strong><code>**attrs</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a></code></dt>
<dd>Alternative to passing 2-tuples. Cannot specify nested attributes
using this method.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[ValueT]</code></dt>
<dd>LazyIterator that only emits values once a condition has failed.
All items before this are discarded.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.skip_while" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="skip_while" href="../iterators.html#hikari.iterators.LazyIterator.skip_while" id="hikari.impl.stateful_guild_chunker.ChunkStream.skip_while">skip_while</a>(
    *predicates: <a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[<a href='#hikari.iterators.ValueT'>ValueT</a>], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>]],
    **attrs: <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>,
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="skip_while -- Discard items while all conditions are True …" href="../iterators.html#hikari.iterators.LazyIterator.skip_while"
>skip_while</a></code>
</p>
<p>Discard items while all conditions are True.</p>
<p>Items after this will be yielded as normal.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>*predicates</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[ValueT], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>]]</code></dt>
<dd>Predicates to invoke. These are functions that take a value and
return <code><a href='https://docs.python.org/3/library/constants.html#True'>True</a></code> if it is of interest, or <code><a href='https://docs.python.org/3/library/constants.html#False'>False</a></code>
otherwise. These may instead include 2-<code><a href='https://docs.python.org/3/library/stdtypes.html#tuple'>tuple</a></code> objects
consisting of a <code><a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a></code> attribute name (nested attributes
are referred to using the <code>.</code> operator), and values to compare for
equality. This allows you to specify conditions such as
<code>members.skip_while(("user.bot", <a href='https://docs.python.org/3/library/constants.html#True'>True</a>))</code>.</dd>
<dt><strong><code>**attrs</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a></code></dt>
<dd>Alternative to passing 2-tuples. Cannot specify nested attributes
using this method.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[ValueT]</code></dt>
<dd>LazyIterator that only emits values once a condition has been met.
All items before this are discarded.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.sort" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="sort" href="../iterators.html#hikari.iterators.LazyIterator.sort" id="hikari.impl.stateful_guild_chunker.ChunkStream.sort">sort</a>(
    *,
    key: <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a> = None,
    reverse: <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a> = False,
) -> Sequence[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="sort -- Collect all results, then sort the collection before returning it." href="../iterators.html#hikari.iterators.LazyIterator.sort"
>sort</a></code>
</p>
<p>Collect all results, then sort the collection before returning it.</p>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.take_until" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="take_until" href="../iterators.html#hikari.iterators.LazyIterator.take_until" id="hikari.impl.stateful_guild_chunker.ChunkStream.take_until">take_until</a>(
    *predicates: <a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[<a href='#hikari.iterators.ValueT'>ValueT</a>], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>]],
    **attrs: <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>,
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="take_until -- Return each item until any conditions pass or the end is reached …" href="../iterators.html#hikari.iterators.LazyIterator.take_until"
>take_until</a></code>
</p>
<p>Return each item until any conditions pass or the end is reached.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>*predicates</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[ValueT], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>]]</code></dt>
<dd>Predicates to invoke. These are functions that take a value and
return <code><a href='https://docs.python.org/3/library/constants.html#True'>True</a></code> if it is of interest, or <code><a href='https://docs.python.org/3/library/constants.html#False'>False</a></code>
otherwise. These may instead include 2-<code><a href='https://docs.python.org/3/library/stdtypes.html#tuple'>tuple</a></code> objects
consisting of a <code><a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a></code> attribute name (nested attributes are
referred to using the <code>.</code> operator), and values to compare for
equality. This allows you to specify conditions such as
<code>members.take_until(("user.bot", <a href='https://docs.python.org/3/library/constants.html#True'>True</a>))</code>.</dd>
<dt><strong><code>**attrs</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a></code></dt>
<dd>Alternative to passing 2-tuples. Cannot specify nested attributes
using this method.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[ValueT]</code></dt>
<dd>LazyIterator that only emits values until any conditions are
matched.</dd>
</dl>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.ChunkStream.take_while" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="take_while" href="../iterators.html#hikari.iterators.LazyIterator.take_while" id="hikari.impl.stateful_guild_chunker.ChunkStream.take_while">take_while</a>(
    *predicates: <a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[<a href='#hikari.iterators.ValueT'>ValueT</a>], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>]],
    **attrs: <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>,
) -> <a href='#hikari.iterators.LazyIterator'>LazyIterator</a>[~<a href='#hikari.iterators.ValueT'>ValueT</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="EventStream -- An implementation of an event `Streamer` class …" href="../event_stream.html#hikari.event_stream.EventStream"
>EventStream</a></code>.<code><a title="take_while -- Return each item until any conditions fail or the end is reached …" href="../iterators.html#hikari.iterators.LazyIterator.take_while"
>take_while</a></code>
</p>
<p>Return each item until any conditions fail or the end is reached.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>*predicates</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Callable'>Callable</a>[[ValueT], <a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>], <a href='https://docs.python.org/3/library/typing.html#typing.Tuple'>Tuple</a>[<a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>]]</code></dt>
<dd>Predicates to invoke. These are functions that take a value and
return <code><a href='https://docs.python.org/3/library/constants.html#True'>True</a></code> if it is of interest, or <code><a href='https://docs.python.org/3/library/constants.html#False'>False</a></code>
otherwise. These may instead include 2-<code><a href='https://docs.python.org/3/library/stdtypes.html#tuple'>tuple</a></code> objects
consisting of a <code><a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a></code> attribute name (nested attributes
are referred to using the <code>.</code> operator), and values to compare for
equality. This allows you to specify conditions such as
<code>members.take_while(("user.bot", <a href='https://docs.python.org/3/library/constants.html#True'>True</a>))</code>.</dd>
<dt><strong><code>**attrs</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a></code></dt>
<dd>Alternative to passing 2-tuples. Cannot specify nested attributes
using this method.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>LazyIterator[ValueT]</code></dt>
<dd>LazyIterator that only emits values until any conditions are not
matched.</dd>
</dl>
</dd>
<div class="sep"></div>
</dl>
<div class="sep"></div>
</dd>
<dt>
<h4><small class='text-muted'><em><abbr title='A standard Python type.'>class</abbr></em></small> <a title="StatefulGuildChunkerImpl -- Guild chunker implementation …" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl"
>StatefulGuildChunkerImpl</a></h4>
</dt>
<dd>
<pre><code id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl" class="hljs python"><abbr title='A standard Python type.'>class</abbr> StatefulGuildChunkerImpl (
    app: <a href='../traits.html#hikari.traits.BotAware'>traits.BotAware</a>,
    limit: <a href='https://docs.python.org/3/library/functions.html#int'>int</a> = 200,
): ...</code></pre>
<p>Guild chunker implementation.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>app</code></strong> :&ensp;<code><a href='../traits.html#hikari.traits.BotAware'>BotAware</a></code></dt>
<dd>The object of the bot aware app this is bound to.</dd>
<dt><strong><code>limit</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/functions.html#int'>int</a></code></dt>
<dd>The maximum amount of requests that this chunker should store information
about for each shard.</dd>
</dl>
<div class="sep"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L202-L320" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">class StatefulGuildChunkerImpl(chunker.GuildChunker):
    &#34;&#34;&#34;Guild chunker implementation.

    Parameters
    ----------
    app : hikari.traits.BotAware
        The object of the bot aware app this is bound to.
    limit : builtins.int
        The maximum amount of requests that this chunker should store information
        about for each shard.
    &#34;&#34;&#34;

    __slots__: typing.Sequence[str] = (&#34;_app&#34;, &#34;_limit&#34;, &#34;_tracked&#34;)

    def __init__(self, app: traits.BotAware, limit: int = 200) -&gt; None:
        self._app = app
        self._limit = limit
        self._tracked: typing.MutableMapping[int, collections.LimitedCapacityCacheMap[str, _TrackedRequests]] = {}

    def _default_include_presences(
        self, guild_id: snowflakes.Snowflake, include_presences: undefined.UndefinedOr[bool]
    ) -&gt; bool:
        if include_presences is not undefined.UNDEFINED:
            return include_presences

        shard_id = snowflakes.calculate_shard_id(self._app, guild_id)
        shard = self._app.shards[shard_id]
        return bool(shard.intents &amp; intents_.Intents.GUILD_PRESENCES)

    def fetch_members_for_guild(
        self,
        guild: snowflakes.SnowflakeishOr[guilds.GatewayGuild],
        *,
        timeout: typing.Union[int, float, None],
        limit: typing.Optional[int] = None,
        include_presences: undefined.UndefinedOr[bool] = undefined.UNDEFINED,
        query_limit: int = 0,
        query: str = &#34;&#34;,
        users: undefined.UndefinedOr[typing.Sequence[snowflakes.SnowflakeishOr[users_.User]]] = undefined.UNDEFINED,
    ) -&gt; event_stream.Streamer[shard_events.MemberChunkEvent]:
        guild_id = snowflakes.Snowflake(guild)
        return ChunkStream(
            app=self._app,
            guild_id=guild_id,
            timeout=timeout,
            limit=limit,
            include_presences=self._default_include_presences(guild_id, include_presences),
            query_limit=query_limit,
            query=query,
            users=users,
        )

    async def get_request_status(self, nonce: str, /) -&gt; typing.Optional[chunker.RequestInformation]:
        try:
            shard_id = int(nonce.split(&#34;.&#34;, 1)[0])
        except ValueError:
            return None
        else:
            return copy.copy(self._tracked[shard_id].get(nonce)) if shard_id in self._tracked else None

    async def list_requests_for_shard(
        self, shard: typing.Union[gateway_shard.GatewayShard, int], /
    ) -&gt; typing.Sequence[chunker.RequestInformation]:
        shard_id = shard if isinstance(shard, int) else shard.id

        if shard_id not in self._tracked:
            return ()

        return tuple(copy.copy(chunk) for chunk in self._tracked[shard_id].copy().values())

    async def list_requests_for_guild(
        self, guild: snowflakes.SnowflakeishOr[guilds.GatewayGuild], /
    ) -&gt; typing.Sequence[chunker.RequestInformation]:
        guild_id = snowflakes.Snowflake(guild)
        shard_id = snowflakes.calculate_shard_id(self._app, guild_id)
        if shard_id not in self._tracked:
            return ()

        return tuple(copy.copy(event) for event in self._tracked[shard_id].values() if event.guild_id == guild_id)

    async def consume_chunk_event(self, event: shard_events.MemberChunkEvent, /) -&gt; None:
        if (
            event.shard.id not in self._tracked
            or event.nonce is None
            or event.nonce not in self._tracked[event.shard.id]
        ):
            return

        self._tracked[event.shard.id][event.nonce].update(event)

    async def request_guild_members(
        self,
        guild: snowflakes.SnowflakeishOr[guilds.GatewayGuild],
        /,
        include_presences: undefined.UndefinedOr[bool] = undefined.UNDEFINED,
        limit: int = 0,
        query: str = &#34;&#34;,
        users: undefined.UndefinedOr[typing.Sequence[snowflakes.SnowflakeishOr[users_.User]]] = undefined.UNDEFINED,
    ) -&gt; str:
        guild_id = snowflakes.Snowflake(guild)
        shard_id = snowflakes.calculate_shard_id(self._app, guild_id)
        nonce = f&#34;{shard_id}.{_random_nonce()}&#34;
        if shard_id not in self._tracked:
            self._tracked[shard_id] = collections.LimitedCapacityCacheMap(limit=self._limit)

        tracker = _TrackedRequests(guild_id=guild_id, nonce=nonce)
        self._tracked[shard_id][nonce] = tracker
        await self._app.shards[shard_id].request_guild_members(
            guild=guild_id,
            include_presences=self._default_include_presences(guild_id, include_presences),
            limit=limit,
            nonce=nonce,
            query=query,
            users=users,
        )
        return nonce

    async def close(self) -&gt; None:
        return None</code></pre>
</details>
<div class="sep"></div>
<h5>Method resolution order</h5>
<dl>
<dt class="nested"><small class='text-muted'><em><abbr title='A standard Python type.'>class</abbr></em></small> <a title="StatefulGuildChunkerImpl -- Guild chunker implementation …" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl"
>StatefulGuildChunkerImpl</a></dt>
<dd class="nested"><em class="text-muted">That's this class!</em></dd>
<dt class="nested"><small class='text-muted'><em><abbr title='An abstract base class which may have abstract methods and abstract properties.'>abstract</abbr> <abbr title='A standard Python type.'>class</abbr></em></small> <a title="GuildChunker -- Component specialization that is used to manage guild chunking." href="../api/chunker.html#hikari.api.chunker.GuildChunker"
>GuildChunker</a></dt>
<dd class="nested"><p>Component specialization that is used to manage guild chunking.</p></dd>
<dt class="nested"><small class='text-muted'><em><abbr title='Anything that is external to this library.'>extern</abbr> class</em></small> <a title="abc.ABC -- Helper class that provides a standard way to create an ABC using
inheritance." href="https://docs.python.org/3/library/abc.html#abc.ABC"
>abc.ABC</a></dt>
<dd class="nested"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p></dd>
</dl>
<div class="sep"></div>
<h5>Methods</h5>
<dl>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.close" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="close" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.close" id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.close">close</a>() -> None: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="GuildChunker -- Component specialization that is used to manage guild chunking." href="../api/chunker.html#hikari.api.chunker.GuildChunker"
>GuildChunker</a></code>.<code><a title="close -- Close the guild chunker." href="../api/chunker.html#hikari.api.chunker.GuildChunker.close"
>close</a></code>
</p>
<p>Close the guild chunker.</p>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L319-L320" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">async def close(self) -&gt; None:
    return None</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.consume_chunk_event" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="consume_chunk_event" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.consume_chunk_event" id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.consume_chunk_event">consume_chunk_event</a>(
    event: <a href='../events/shard_events.html#hikari.events.shard_events.MemberChunkEvent'>shard_events.MemberChunkEvent</a>,
    /,
) -> None: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="GuildChunker -- Component specialization that is used to manage guild chunking." href="../api/chunker.html#hikari.api.chunker.GuildChunker"
>GuildChunker</a></code>.<code><a title="consume_chunk_event -- Listen to chunk events …" href="../api/chunker.html#hikari.api.chunker.GuildChunker.consume_chunk_event"
>consume_chunk_event</a></code>
</p>
<p>Listen to chunk events.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>event</code></strong> :&ensp;<code><a href='../events/shard_events.html#hikari.events.shard_events.MemberChunkEvent'>MemberChunkEvent</a></code></dt>
<dd>The object of the chunk event that's being consumed.</dd>
</dl>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L282-L290" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">async def consume_chunk_event(self, event: shard_events.MemberChunkEvent, /) -&gt; None:
    if (
        event.shard.id not in self._tracked
        or event.nonce is None
        or event.nonce not in self._tracked[event.shard.id]
    ):
        return

    self._tracked[event.shard.id][event.nonce].update(event)</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.fetch_members_for_guild" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="fetch_members_for_guild" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.fetch_members_for_guild" id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.fetch_members_for_guild">fetch_members_for_guild</a>(
    guild: <a href='../snowflakes.html#hikari.snowflakes.SnowflakeishOr'>snowflakes.SnowflakeishOr</a>[<a href='../guilds.html#hikari.guilds.GatewayGuild'>guilds.GatewayGuild</a>],
    *,
    timeout: <a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='https://docs.python.org/3/library/functions.html#int'>int</a>, <a href='https://docs.python.org/3/library/functions.html#float'>float</a>, <a href='https://docs.python.org/3/library/constants.html#None'>None</a>],
    limit: <a href='https://docs.python.org/3/library/typing.html#typing.Optional'>Optional</a>[<a href='https://docs.python.org/3/library/functions.html#int'>int</a>] = None,
    include_presences: <a href='../undefined.html#hikari.undefined.UndefinedOr'>undefined.UndefinedOr</a>[<a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>] = UNDEFINED,
    query_limit: <a href='https://docs.python.org/3/library/functions.html#int'>int</a> = 0,
    query: <a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a> = '',
    users: <a href='../undefined.html#hikari.undefined.UndefinedOr'>undefined.UndefinedOr</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[<a href='../snowflakes.html#hikari.snowflakes.SnowflakeishOr'>snowflakes.SnowflakeishOr</a>[<a href='../users.html#hikari.users.User'>users_.User</a>]]] = UNDEFINED,
) -> <a href='../event_stream.html#hikari.event_stream.Streamer'>event_stream.Streamer</a>[<a href='../events/shard_events.html#hikari.events.shard_events.MemberChunkEvent'>shard_events.MemberChunkEvent</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="GuildChunker -- Component specialization that is used to manage guild chunking." href="../api/chunker.html#hikari.api.chunker.GuildChunker"
>GuildChunker</a></code>.<code><a title="fetch_members_for_guild -- Request for a guild chunk …" href="../api/chunker.html#hikari.api.chunker.GuildChunker.fetch_members_for_guild"
>fetch_members_for_guild</a></code>
</p>
<p>Request for a guild chunk.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>guild</code></strong> :&ensp;<code><a href='../guilds.html#hikari.guilds.Guild'>Guild</a></code></dt>
<dd>The guild to request chunk for.</dd>
</dl>
<h2 id="other-parameters">Other Parameters</h2>
<dl>
<dt><strong><code>timeout</code></strong> :&ensp;<code>typing.Union[builtins.int, builtins.float, builtins.None]</code></dt>
<dd>The maximum amount of time the returned stream should spend waiting
for the next chunk event to be received before ending the iteration.
If <code><a href='https://docs.python.org/3/library/constants.html#None'>None</a></code> then this will never timeout between events.</dd>
<dt><strong><code>limit</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Optional'>Optional</a>[<a href='https://docs.python.org/3/library/functions.html#int'>int</a>]</code></dt>
<dd>The limit for how many events the streamer should queue before
dropping extra received events. Leave as <code><a href='https://docs.python.org/3/library/constants.html#None'>None</a></code> for this to
be unlimited.</dd>
<dt><strong><code>include_presences</code></strong> :&ensp;<code><a href='../undefined.html#hikari.undefined.UndefinedOr'>UndefinedOr</a>[<a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>]</code></dt>
<dd>If provided, whether to request presences.</dd>
<dt><strong><code>query</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a></code></dt>
<dd>If not <code>""</code>, request the members which username starts with the string.</dd>
<dt><strong><code>query_limit</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/functions.html#int'>int</a></code></dt>
<dd>Maximum number of members to send matching the query.</dd>
<dt><strong><code>users</code></strong> :&ensp;<code><a href='../undefined.html#hikari.undefined.UndefinedOr'>UndefinedOr</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[<a href='../snowflakes.html#hikari.snowflakes.SnowflakeishOr'>SnowflakeishOr</a>[<a href='../users.html#hikari.users.User'>User</a>]]]</code></dt>
<dd>If provided, the users to request for.</dd>
</dl>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p>To request the full list of members, set <code>query</code> to <code>""</code> (empty
string) and <code>limit</code> to <code>0</code>.</p>
</div>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p>The chunk request will not be sent off until the returned stream is
opened.</p>
</div>
<div class="alert alert-warning">
<p class="admonition-title">Warning</p>
<p>Validation errors like <code><a href='https://docs.python.org/3/library/exceptions.html#ValueError'>ValueError</a></code> and
<code><a href='../errors.html#hikari.errors.MissingIntentError'>MissingIntentError</a></code> will be delayed until you open
the returned stream.</p>
</div>
<h2 id="returns">Returns</h2>
<dl>
<dt><code><a href='../event_stream.html#hikari.event_stream.Streamer'>Streamer</a>[<a href='../events/shard_events.html#hikari.events.shard_events.MemberChunkEvent'>MemberChunkEvent</a>]</code></dt>
<dd>A stream of chunk events for the generated request.</dd>
</dl>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L231-L252" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">def fetch_members_for_guild(
    self,
    guild: snowflakes.SnowflakeishOr[guilds.GatewayGuild],
    *,
    timeout: typing.Union[int, float, None],
    limit: typing.Optional[int] = None,
    include_presences: undefined.UndefinedOr[bool] = undefined.UNDEFINED,
    query_limit: int = 0,
    query: str = &#34;&#34;,
    users: undefined.UndefinedOr[typing.Sequence[snowflakes.SnowflakeishOr[users_.User]]] = undefined.UNDEFINED,
) -&gt; event_stream.Streamer[shard_events.MemberChunkEvent]:
    guild_id = snowflakes.Snowflake(guild)
    return ChunkStream(
        app=self._app,
        guild_id=guild_id,
        timeout=timeout,
        limit=limit,
        include_presences=self._default_include_presences(guild_id, include_presences),
        query_limit=query_limit,
        query=query,
        users=users,
    )</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.get_request_status" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="get_request_status" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.get_request_status" id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.get_request_status">get_request_status</a>(
    nonce: <a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>,
    /,
) -> Union[<a href='../api/chunker.html#hikari.api.chunker.RequestInformation'>RequestInformation</a>, None]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="GuildChunker -- Component specialization that is used to manage guild chunking." href="../api/chunker.html#hikari.api.chunker.GuildChunker"
>GuildChunker</a></code>.<code><a title="get_request_status -- Return the status of a request …" href="../api/chunker.html#hikari.api.chunker.GuildChunker.get_request_status"
>get_request_status</a></code>
</p>
<p>Return the status of a request.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>nonce</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a></code></dt>
<dd>The unique identifier for the tracked request to get.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code><a href='https://docs.python.org/3/library/typing.html#typing.Optional'>Optional</a>[RequestInformation]</code></dt>
<dd>Information about the request if found, else <code><a href='https://docs.python.org/3/library/constants.html#None'>None</a></code>.</dd>
</dl>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L254-L260" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">async def get_request_status(self, nonce: str, /) -&gt; typing.Optional[chunker.RequestInformation]:
    try:
        shard_id = int(nonce.split(&#34;.&#34;, 1)[0])
    except ValueError:
        return None
    else:
        return copy.copy(self._tracked[shard_id].get(nonce)) if shard_id in self._tracked else None</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.list_requests_for_guild" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="list_requests_for_guild" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.list_requests_for_guild" id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.list_requests_for_guild">list_requests_for_guild</a>(
    guild: <a href='../snowflakes.html#hikari.snowflakes.SnowflakeishOr'>snowflakes.SnowflakeishOr</a>[<a href='../guilds.html#hikari.guilds.GatewayGuild'>guilds.GatewayGuild</a>],
    /,
) -> <a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[<a href='../api/chunker.html#hikari.api.chunker.RequestInformation'>chunker.RequestInformation</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="GuildChunker -- Component specialization that is used to manage guild chunking." href="../api/chunker.html#hikari.api.chunker.GuildChunker"
>GuildChunker</a></code>.<code><a title="list_requests_for_guild -- List the statuses of requests made for a specific guild …" href="../api/chunker.html#hikari.api.chunker.GuildChunker.list_requests_for_guild"
>list_requests_for_guild</a></code>
</p>
<p>List the statuses of requests made for a specific guild.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>guild</code></strong> :&ensp;<code><a href='../snowflakes.html#hikari.snowflakes.SnowflakeishOr'>SnowflakeishOr</a>[<a href='../guilds.html#hikari.guilds.GatewayGuild'>GatewayGuild</a>]</code></dt>
<dd>The object or ID of the guild to get the tracked requests for.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code><a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[RequestInformation]</code></dt>
<dd>A sequence of data objects of information about the tracked requests
for the given guild.</dd>
</dl>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L272-L280" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">async def list_requests_for_guild(
    self, guild: snowflakes.SnowflakeishOr[guilds.GatewayGuild], /
) -&gt; typing.Sequence[chunker.RequestInformation]:
    guild_id = snowflakes.Snowflake(guild)
    shard_id = snowflakes.calculate_shard_id(self._app, guild_id)
    if shard_id not in self._tracked:
        return ()

    return tuple(copy.copy(event) for event in self._tracked[shard_id].values() if event.guild_id == guild_id)</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.list_requests_for_shard" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="list_requests_for_shard" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.list_requests_for_shard" id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.list_requests_for_shard">list_requests_for_shard</a>(
    shard: <a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='../api/shard.html#hikari.api.shard.GatewayShard'>gateway_shard.GatewayShard</a>, <a href='https://docs.python.org/3/library/functions.html#int'>int</a>],
    /,
) -> <a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[<a href='../api/chunker.html#hikari.api.chunker.RequestInformation'>chunker.RequestInformation</a>]: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="GuildChunker -- Component specialization that is used to manage guild chunking." href="../api/chunker.html#hikari.api.chunker.GuildChunker"
>GuildChunker</a></code>.<code><a title="list_requests_for_shard -- List the statuses of requests made for a specific shard …" href="../api/chunker.html#hikari.api.chunker.GuildChunker.list_requests_for_shard"
>list_requests_for_shard</a></code>
</p>
<p>List the statuses of requests made for a specific shard.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>shard</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Union'>Union</a>[<a href='../api/shard.html#hikari.api.shard.GatewayShard'>GatewayShard</a>, <a href='https://docs.python.org/3/library/functions.html#int'>int</a>]</code></dt>
<dd>The object or ID of the shard to get the tracked requests for.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code><a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[RequestInformation]</code></dt>
<dd>A sequence of data objects of information about the tracked requests
for the given shard.</dd>
</dl>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L262-L270" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">async def list_requests_for_shard(
    self, shard: typing.Union[gateway_shard.GatewayShard, int], /
) -&gt; typing.Sequence[chunker.RequestInformation]:
    shard_id = shard if isinstance(shard, int) else shard.id

    if shard_id not in self._tracked:
        return ()

    return tuple(copy.copy(chunk) for chunk in self._tracked[shard_id].copy().values())</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.request_guild_members" class="hljs python"><abbr title='A function that returns a coroutine and must be awaited.'>async def</abbr> <a title="request_guild_members" href="#hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.request_guild_members" id="hikari.impl.stateful_guild_chunker.StatefulGuildChunkerImpl.request_guild_members">request_guild_members</a>(
    guild: <a href='../snowflakes.html#hikari.snowflakes.SnowflakeishOr'>snowflakes.SnowflakeishOr</a>[<a href='../guilds.html#hikari.guilds.GatewayGuild'>guilds.GatewayGuild</a>],
    /,
    include_presences: <a href='../undefined.html#hikari.undefined.UndefinedOr'>undefined.UndefinedOr</a>[<a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>] = UNDEFINED,
    limit: <a href='https://docs.python.org/3/library/functions.html#int'>int</a> = 0,
    query: <a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a> = '',
    users: <a href='../undefined.html#hikari.undefined.UndefinedOr'>undefined.UndefinedOr</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[<a href='../snowflakes.html#hikari.snowflakes.SnowflakeishOr'>snowflakes.SnowflakeishOr</a>[<a href='../users.html#hikari.users.User'>users_.User</a>]]] = UNDEFINED,
) -> <a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a>: ...</code></pre>
</dt>
<dd>
<p class="inheritance">
<em><small>Inherited from:</small></em>
<code><a title="GuildChunker -- Component specialization that is used to manage guild chunking." href="../api/chunker.html#hikari.api.chunker.GuildChunker"
>GuildChunker</a></code>.<code><a title="request_guild_members -- Request for a guild chunk …" href="../api/chunker.html#hikari.api.chunker.GuildChunker.request_guild_members"
>request_guild_members</a></code>
</p>
<p>Request for a guild chunk.</p>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p>For the chunker to track a request the request may need to be made
using this method rather than using
<code><a href='../api/shard.html#hikari.api.shard.GatewayShard.request_guild_members'>request_guild_members</a></code>.</p>
</div>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>guild</code></strong> :&ensp;<code><a href='../guilds.html#hikari.guilds.Guild'>Guild</a></code></dt>
<dd>The guild to request chunk for.</dd>
</dl>
<h2 id="other-parameters">Other Parameters</h2>
<dl>
<dt><strong><code>include_presences</code></strong> :&ensp;<code><a href='../undefined.html#hikari.undefined.UndefinedOr'>UndefinedOr</a>[<a href='https://docs.python.org/3/library/functions.html#bool'>bool</a>]</code></dt>
<dd>If provided, whether to request presences.</dd>
<dt><strong><code>query</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a></code></dt>
<dd>If not <code>""</code>, request the members which username starts with the string.</dd>
<dt><strong><code>limit</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/functions.html#int'>int</a></code></dt>
<dd>Maximum number of members to send matching the query.</dd>
<dt><strong><code>users</code></strong> :&ensp;<code><a href='../undefined.html#hikari.undefined.UndefinedOr'>UndefinedOr</a>[<a href='https://docs.python.org/3/library/typing.html#typing.Sequence'>Sequence</a>[<a href='../snowflakes.html#hikari.snowflakes.SnowflakeishOr'>SnowflakeishOr</a>[<a href='../users.html#hikari.users.User'>User</a>]]]</code></dt>
<dd>If provided, the users to request for.</dd>
</dl>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p>To request the full list of members, set <code>query</code> to <code>""</code> (empty
string) and <code>limit</code> to <code>0</code>.</p>
</div>
<h2 id="returns">Returns</h2>
<dl>
<dt><code><a href='https://docs.python.org/3/library/stdtypes.html#str'>str</a></code></dt>
<dd>The generated unique nonce used for tracking this request.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code><a href='https://docs.python.org/3/library/exceptions.html#ValueError'>ValueError</a></code></dt>
<dd>When trying to specify <code>users</code> with <code>query</code>/<code>limit</code>, if <code>limit</code> is not between
0 and 100, both inclusive or if <code>users</code> length is over 100.</dd>
<dt><code><a href='../errors.html#hikari.errors.MissingIntentError'>MissingIntentError</a></code></dt>
<dd>When trying to request presences without the <code>GUILD_MEMBERS</code> or when trying to
request the full list of members without <code>GUILD_PRESENCES</code>.</dd>
</dl>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/impl/stateful_guild_chunker.py#L292-L317" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">async def request_guild_members(
    self,
    guild: snowflakes.SnowflakeishOr[guilds.GatewayGuild],
    /,
    include_presences: undefined.UndefinedOr[bool] = undefined.UNDEFINED,
    limit: int = 0,
    query: str = &#34;&#34;,
    users: undefined.UndefinedOr[typing.Sequence[snowflakes.SnowflakeishOr[users_.User]]] = undefined.UNDEFINED,
) -&gt; str:
    guild_id = snowflakes.Snowflake(guild)
    shard_id = snowflakes.calculate_shard_id(self._app, guild_id)
    nonce = f&#34;{shard_id}.{_random_nonce()}&#34;
    if shard_id not in self._tracked:
        self._tracked[shard_id] = collections.LimitedCapacityCacheMap(limit=self._limit)

    tracker = _TrackedRequests(guild_id=guild_id, nonce=nonce)
    self._tracked[shard_id][nonce] = tracker
    await self._app.shards[shard_id].request_guild_members(
        guild=guild_id,
        include_presences=self._default_include_presences(guild_id, include_presences),
        limit=limit,
        nonce=nonce,
        query=query,
        users=users,
    )
    return nonce</code></pre>
</details>
</dd>
<div class="sep"></div>
</dl>
<div class="sep"></div>
</dd>
</dl>
</section>
</div>
</div>
</div>
<!-- Search script and dependencies -->
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../search.html#' + encodeURIComponent(query);
window.location.href = url;
};
</script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>