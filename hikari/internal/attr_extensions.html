<!--
Copyright (c) 2020 Nekokatt
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<!--
Copyright (c) 2020 Nekokatt
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>hikari.internal.attr_extensions API documentation</title>
<meta name="description" content="Utility for extending and optimising the usage of attr models." />
<meta property="og:title" content="hikari.internal.attr_extensions module documentation" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://hikari-py.github.io/hikari/logo.png" />
<meta property="og:description" content="A Discord Bot framework for modern Python and asyncio built on good intentions" />
<meta property="theme-color" content="#ff029a" />
<link rel="shortcut icon" type="image/png" href="https://hikari-py.github.io/hikari/logo.png"/>
<!--<script async src="https://cse.google.com/cse.js?cx=017837193012385208679:pey8ky8gdqw"></script>
<style>.gsc-control-cse {padding:0 !important;margin-top:1em}</style>-->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css" rel="stylesheet"/>
<style>
* {
scrollbar-color: #202324 #454a4d;
scroll-behavior: smooth;
}
img#logo {
border-radius: 15px;
width: 30px;
height: 30px;
margin-right: 0.5em;
}
small.smaller {
font-size: 0.75em;
}
body {
background-color: #181A1B;
color: #C9C5C0;
}
h1 {
margin-top: 3rem;
}
h2 {
margin-top: 1.75rem;
margin-bottom: 1em;
}
h3 {
margin-top: 1.25rem;
}
h4 {
margin-top: 1rem;
}
.nav-section {
margin-top: 2em;
}
.monospaced {
font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}
a.sidebar-nav-pill,
a.sidebar-nav-pill:active,
a.sidebar-nav-pill:hover {
color: #BDB7AF;
}
.module-source > details > pre {
display: block;
overflow-x: auto;
overflow-y: auto;
max-height: 600px;
font-size: 0.8em;
}
a {
color: #DE4F91;
}
a:hover {
color: #64B1F2;
}
.jumbotron {
background-color: #232627;
}
.breadcrumb-item.inactive > a {
color: #d264d0 !important;
}
.breadcrumb-item.active > a {
color: #de4f91 !important;
}
.breadcrumb-item+.breadcrumb-item::before {
content: ".";
}
.module-breadcrumb {
padding-left: 0 !important;
background-color: #232627;
}
ul.nested {
margin-left: 1em;
}
h2#parameters::after {
margin-left: 2em;
}
dt {
margin-left: 2em;
}
dd {
margin-left: 4em;
}
dl.no-nest > dt {
margin-left: 0em;
}
dl.no-nest > dd {
margin-left: 2em;
}
dl.root {
margin-bottom: 2em;
}
.definition {
display: block;
margin-bottom: 8em !important;
}
.definition .row {
display: block;
margin-bottom: 4em !important;
}
.definition h2 {
font-size: 1em;
font-weight: bolder;
}
.sep {
height: 2em;
}
code {
color: #DB61D9;
}
code .active {
color: #e83e8c;
}
code a {
color: #E94A93;
}
a.dotted:hover, abbr:hover {
text-decoration: underline #9E9689 dotted !important;
}
a.dotted, abbr {
text-decoration: none !important;
}
.gsc-search-box, .gsc-search-box-tools, .gsc-control-cse {
background: none !important;
border: none !important;
}
.gsc-search-button-v2, .gsc-search-button-v2:hover, .gsc-search-button-v2:focus {
color: var(--success) !important;
border-color: var(--success) !important;
background: none !important;
padding: 6px 32px !important;
font-size: inherit !important;
}
.gsc-search-button-v2 > svg {
fill: var(--success) !important;
}
.gsc-input-box {
border-radius: 3px;
}
.gsc-control-cse {
width: 300px !important;
margin-top: 0 !important;
}
.gsc-control-cse .gsc-control-cse-en {
margin-top: 0 !important;
}
.bg-dark {
background-color: #2C2F31 !important;
}
.text-muted {
color: #9E9689 !important;
}
.alert-primary {
color: #7CC3FF;
background-color: #262A2B;
border-color: #003B7B;
}
.alert-secondary {
color: #C2BCB4;
background-color: #282B2C;
border-color: #3B4042;
}
.alert-success {
color: #99E6AB;
background-color: #1A3E29;
border-color: #255A32;
}
.alert-info {
color: #8EE3F1;
background-color: #143B43;
border-color: #1E5961;
}
.alert-warning {
color: #FBD770;
background-color: #513E00;
border-color: #7B5C00;
}
.alert-danger {
color: rgb(225, 134, 143);
background-color: rgb(67, 12, 17);
border-color: rgb(104, 18, 27);
}
mark {
background-color: #333333;
border-radius: 0.1em;
color: #DB61D9;
}
</style>
<script async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML'></script>
</head>
<body>
<!-- body.mako -->
<nav id="main-nav" class="navbar navbar-dark navbar-expand-lg bg-dark">
<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"/>
</button>
<a class="navbar-brand" href="https://github.com/hikari-py/hikari"><img class="d-inline-block align-top" src="https://hikari-py.github.io/hikari/logo.png" id="logo" alt="hikari logo" loading="lazy"/>Hikari <small>v2.0.0.dev92</small></a>
<div class="collapse navbar-collapse" id="navbarNavDropdown">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/hikari/index.html">Home</a></li>
<li class="nav-item active"><a class="nav-link" href="/hikari/hikari/index.html">Documentation</a></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/hikari-py/hikari">GitHub</a></li>
<li class="nav-item"><a class="nav-link" href="https://pypi.org/project/hikari">PyPI</a></li>
<li class="nav-item"><a class="nav-link" href="https://discord.gg/Jx4cNGG">Discord Server</a></li>
</ul>
<form class="form-inline" >
<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" id="lunr-search"/>
<button class="btn btn-outline-success my-2 my-sm-0" type="submit">&gt;</button>
</form>
</div>
</nav>
<div class="jumbotron jumbotron-fluid">
<div class="container">
<h1 class="display-4"><code>
<nav aria-label="breadcrumb">
<ol class="breadcrumb module-breadcrumb">
<li class="breadcrumb-item inactive"><a title="hikari -- A sane Python framework for writing modern Discord bots …" href="../index.html"
>hikari</a></li>
<li class="breadcrumb-item inactive"><a title="hikari.internal -- Package containing internal utilities used within this API." href="index.html"
>internal</a></li>
<li class="breadcrumb-item active"><a href="#">attr_extensions</a></li>
</ol>
</nav>
</code></h1>
<p class="lead"><p>Utility for extending and optimising the usage of attr models.</p></p>
</div>
</div>
<div class="container-xl">
<div class="row">
<div class="d-md-none d-lg-block col-lg-5 col-xl-4">
<!--<nav class="nav" id="content-nav">-->
<h3>This module</h3>
<ul class="list-unstyled text-truncate">
<li class="text-truncate monospaced"><small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="copy_attrs -- Shallow copy an attrs model with `init` enabled …" href="#hikari.internal.attr_extensions.copy_attrs"
>copy_attrs</a></li>
<li class="text-truncate monospaced"><small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="deep_copy_attrs -- Deep copy an attrs model with `init` enabled …" href="#hikari.internal.attr_extensions.deep_copy_attrs"
>deep_copy_attrs</a></li>
<li class="text-truncate monospaced"><small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="invalidate_deep_copy_cache -- Remove all the globally cached generated deep copy functions." href="#hikari.internal.attr_extensions.invalidate_deep_copy_cache"
>invalidate_deep_copy_cache</a></li>
<li class="text-truncate monospaced"><small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="invalidate_shallow_copy_cache -- Remove all the globally cached copy functions." href="#hikari.internal.attr_extensions.invalidate_shallow_copy_cache"
>invalidate_shallow_copy_cache</a></li>
<li class="text-truncate monospaced"><small class='text-muted'><em><abbr title='A standard Python function.'>def</abbr></em></small> <a title="with_copy -- Add a custom implementation for copying attrs models to a class …" href="#hikari.internal.attr_extensions.with_copy"
>with_copy</a></li>
</ul>
<!--</nav>-->
</div>
<div class="col-xs-12 col-lg-7 col-xl-8">
<div class="row">
<div class="col module-source">
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/internal/attr_extensions.py#L0-L257" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
# cython: language_level=3
# Copyright (c) 2020 Nekokatt
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the &#34;Software&#34;), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED &#34;AS IS&#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.
&#34;&#34;&#34;Utility for extending and optimising the usage of attr models.&#34;&#34;&#34;
from __future__ import annotations

__all__: typing.List[str] = [
    &#34;with_copy&#34;,
    &#34;copy_attrs&#34;,
    &#34;deep_copy_attrs&#34;,
    &#34;invalidate_deep_copy_cache&#34;,
    &#34;invalidate_shallow_copy_cache&#34;,
]

import copy as std_copy
import logging
import typing

import attr

from hikari.internal import ux

ModelT = typing.TypeVar(&#34;ModelT&#34;)
SKIP_DEEP_COPY: typing.Final[str] = &#34;skip_deep_copy&#34;

_DEEP_COPIERS: typing.MutableMapping[
    typing.Any, typing.Callable[[typing.Any, typing.MutableMapping[int, typing.Any]], None]
] = {}
_SHALLOW_COPIERS: typing.MutableMapping[typing.Any, typing.Callable[[typing.Any], typing.Any]] = {}
_LOGGER = logging.getLogger(&#34;hikari.models&#34;)


def invalidate_shallow_copy_cache() -&gt; None:
    &#34;&#34;&#34;Remove all the globally cached copy functions.&#34;&#34;&#34;
    _LOGGER.debug(&#34;Invalidating attr extensions shallow copy cache&#34;)
    _SHALLOW_COPIERS.clear()


def invalidate_deep_copy_cache() -&gt; None:
    &#34;&#34;&#34;Remove all the globally cached generated deep copy functions.&#34;&#34;&#34;
    _LOGGER.debug(&#34;Invalidating attr extensions deep copy cache&#34;)
    _DEEP_COPIERS.clear()


def get_fields_definition(
    cls: typing.Type[ModelT],
) -&gt; typing.Tuple[
    typing.Sequence[typing.Tuple[attr.Attribute[typing.Any], str]], typing.Sequence[attr.Attribute[typing.Any]]
]:
    &#34;&#34;&#34;Get a sequence of init key-words to their relative attribute.

    Parameters
    ----------
    cls : typing.Type[ModelT]
        The attrs class to get the fields definition for.

    Returns
    -------
    typing.Sequence[typing.Tuple[builtins.str, builtins.str]]
        A sequence of tuples of string attribute names to string key-word names.
    &#34;&#34;&#34;
    init_results = []
    non_init_results = []

    for field in attr.fields(cls):
        if field.init:
            key_word = field.name[1:] if field.name.startswith(&#34;_&#34;) else field.name
            init_results.append((field, key_word))
        else:
            non_init_results.append(field)

    return init_results, non_init_results


# TODO: can we get if the init wasn&#39;t generated for the class?
def generate_shallow_copier(cls: typing.Type[ModelT]) -&gt; typing.Callable[[ModelT], ModelT]:
    &#34;&#34;&#34;Generate a function for shallow copying an attrs model with `init` enabled.

    Parameters
    ----------
    cls : typing.Type[ModelT]
        The attrs class to generate a shallow copying function for.

    Returns
    -------
    typing.Callable[[ModelT], ModelT]
        The generated shallow copying function.
    &#34;&#34;&#34;
    kwargs, setters = get_fields_definition(cls)
    kwargs = &#34;,&#34;.join(f&#34;{kwarg}=m.{attribute.name}&#34; for attribute, kwarg in kwargs)
    setters = &#34;;&#34;.join(f&#34;r.{attribute.name}=m.{attribute.name}&#34; for attribute in setters) + &#34;;&#34; if setters else &#34;&#34;
    code = f&#34;def copy(m):r=cls({kwargs});{setters}return r&#34;
    globals_ = {&#34;cls&#34;: cls}
    _LOGGER.log(ux.TRACE, &#34;generating shallow copy function for %r: %r&#34;, cls, code)
    exec(code, globals_)  # noqa: S102 - Use of exec detected.
    return typing.cast(&#34;typing.Callable[[ModelT], ModelT]&#34;, globals_[&#34;copy&#34;])


def get_or_generate_shallow_copier(cls: typing.Type[ModelT]) -&gt; typing.Callable[[ModelT], ModelT]:
    &#34;&#34;&#34;Get a cached shallow copying function for a an attrs class or generate it.

    Parameters
    ----------
    cls : typing.Type[ModelT]
        The class to get or generate and cache a shallow copying function for.

    Returns
    -------
    typing.Callable[[ModelT], ModelT]
        The cached or generated shallow copying function.
    &#34;&#34;&#34;
    try:
        return _SHALLOW_COPIERS[cls]
    except KeyError:
        copier = generate_shallow_copier(cls)
        _SHALLOW_COPIERS[cls] = copier
        return copier


def copy_attrs(model: ModelT) -&gt; ModelT:
    &#34;&#34;&#34;Shallow copy an attrs model with `init` enabled.

    Parameters
    ----------
    model : ModelT
        The attrs model to shallow copy.

    Returns
    -------
    ModelT
        The new shallow copied attrs model.
    &#34;&#34;&#34;
    return get_or_generate_shallow_copier(type(model))(model)


def _normalize_kwargs_and_setters(
    kwargs: typing.Sequence[typing.Tuple[attr.Attribute[typing.Any], str]],
    setters: typing.Sequence[attr.Attribute[typing.Any]],
) -&gt; typing.Iterable[attr.Attribute[typing.Any]]:
    for attribute, _ in kwargs:
        yield attribute

    yield from setters


def generate_deep_copier(
    cls: typing.Type[ModelT],
) -&gt; typing.Callable[[ModelT, typing.MutableMapping[int, typing.Any]], None]:
    &#34;&#34;&#34;Generate a function for deep copying an attrs model with `init` enabled.

    Parameters
    ----------
    cls : typing.Type[ModelT]
        The attrs class to generate a deep copying function for.

    Returns
    -------
    typing.Callable[[ModelT], ModelT]
        The generated deep copying function.
    &#34;&#34;&#34;
    kwargs, setters = get_fields_definition(cls)

    # Explicitly handle the case of an attrs model with no fields by returning
    # an empty lambda to avoid a SyntaxError being raised.
    if not kwargs and not setters:
        return lambda _, __: None

    setters = &#34;;&#34;.join(
        f&#34;m.{attribute.name}=std_copy(m.{attribute.name},memo)if(id_:=id(m.{attribute.name}))not in memo else memo[id_]&#34;
        for attribute in _normalize_kwargs_and_setters(kwargs, setters)
        if not attribute.metadata.get(SKIP_DEEP_COPY)
    )
    code = f&#34;def deep_copy(m,memo):{setters}&#34;
    globals_ = {&#34;std_copy&#34;: std_copy.deepcopy, &#34;cls&#34;: cls}
    _LOGGER.debug(&#34;generating deep copy function for %r: %r&#34;, cls, code)
    exec(code, globals_)  # noqa: S102 - Use of exec detected.
    return typing.cast(&#34;typing.Callable[[ModelT, typing.MutableMapping[int, typing.Any]], None]&#34;, globals_[&#34;deep_copy&#34;])


def get_or_generate_deep_copier(
    cls: typing.Type[ModelT],
) -&gt; typing.Callable[[ModelT, typing.MutableMapping[int, typing.Any]], None]:
    &#34;&#34;&#34;Get a cached shallow copying function for a an attrs class or generate it.

    Parameters
    ----------
    cls : typing.Type[ModelT]
        The class to get or generate and cache a shallow copying function for.

    Returns
    -------
    typing.Callable[[ModelT], ModelT]
        The cached or generated shallow copying function.
    &#34;&#34;&#34;
    try:
        return _DEEP_COPIERS[cls]
    except KeyError:
        copier = generate_deep_copier(cls)
        _DEEP_COPIERS[cls] = copier
        return copier


def deep_copy_attrs(model: ModelT, memo: typing.Optional[typing.MutableMapping[int, typing.Any]] = None) -&gt; ModelT:
    &#34;&#34;&#34;Deep copy an attrs model with `init` enabled.

    Parameters
    ----------
    model : ModelT
        The attrs model to deep copy.
    memo : typing.Optional[typing.MutableMapping[builtins.int, typing.Any]]
        A memo dictionary of objects already copied during the current copying
        pass, see https://docs.python.org/3/library/copy.html for more details.

    !!! note
        This won&#39;t deep copy attributes where &#34;skip_deep_copy&#34; is set to
        `builtins.True` in their metadata.

    Returns
    -------
    ModelT
        The new deep copied attrs model.
    &#34;&#34;&#34;
    if memo is None:
        memo = {}

    new_object = std_copy.copy(model)
    memo[id(model)] = new_object
    get_or_generate_deep_copier(type(model))(new_object, memo)
    return new_object


def with_copy(cls: typing.Type[ModelT]) -&gt; typing.Type[ModelT]:
    &#34;&#34;&#34;Add a custom implementation for copying attrs models to a class.

    !!! note
        This will only work if the class has an attrs generated init.
    &#34;&#34;&#34;
    cls.__copy__ = copy_attrs  # type: ignore[attr-defined]
    cls.__deepcopy__ = deep_copy_attrs  # type: ignore[attr-defined]
    return cls</code></pre>
</details>
</div>
</div>
<h2 id="functions-heading">Functions</h2>
<section class="definition">
<dl class="no-nest root">
<dt>
<pre><code id="hikari.internal.attr_extensions.copy_attrs" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="copy_attrs" href="#hikari.internal.attr_extensions.copy_attrs" id="hikari.internal.attr_extensions.copy_attrs">copy_attrs</a>(
    model: ModelT,
) -> ~ModelT: ...</code></pre>
</dt>
<dd>
<p>Shallow copy an attrs model with <code><a href='https://www.attrs.org/en/stable/init.html'>init</a></code> enabled.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>model</code></strong> :&ensp;<code>ModelT</code></dt>
<dd>The attrs model to shallow copy.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>ModelT</code></dt>
<dd>The new shallow copied attrs model.</dd>
</dl>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/internal/attr_extensions.py#L138-L151" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">def copy_attrs(model: ModelT) -&gt; ModelT:
    &#34;&#34;&#34;Shallow copy an attrs model with `init` enabled.

    Parameters
    ----------
    model : ModelT
        The attrs model to shallow copy.

    Returns
    -------
    ModelT
        The new shallow copied attrs model.
    &#34;&#34;&#34;
    return get_or_generate_shallow_copier(type(model))(model)</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.internal.attr_extensions.deep_copy_attrs" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="deep_copy_attrs" href="#hikari.internal.attr_extensions.deep_copy_attrs" id="hikari.internal.attr_extensions.deep_copy_attrs">deep_copy_attrs</a>(
    model: ModelT,
    memo: <a href='https://docs.python.org/3/library/typing.html#typing.Optional'>Optional</a>[<a href='https://docs.python.org/3/library/typing.html#typing.MutableMapping'>MutableMapping</a>[<a href='https://docs.python.org/3/library/functions.html#int'>int</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>]] = None,
) -> ~ModelT: ...</code></pre>
</dt>
<dd>
<p>Deep copy an attrs model with <code><a href='https://www.attrs.org/en/stable/init.html'>init</a></code> enabled.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>model</code></strong> :&ensp;<code>ModelT</code></dt>
<dd>The attrs model to deep copy.</dd>
<dt><strong><code>memo</code></strong> :&ensp;<code><a href='https://docs.python.org/3/library/typing.html#typing.Optional'>Optional</a>[<a href='https://docs.python.org/3/library/typing.html#typing.MutableMapping'>MutableMapping</a>[<a href='https://docs.python.org/3/library/functions.html#int'>int</a>, <a href='https://docs.python.org/3/library/typing.html#typing.Any'>Any</a>]]</code></dt>
<dd>A memo dictionary of objects already copied during the current copying
pass, see <a href="https://docs.python.org/3/library/copy.html">https://docs.python.org/3/library/copy.html</a> for more details.</dd>
</dl>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p>This won't deep copy attributes where "skip_deep_copy" is set to
<code><a href='https://docs.python.org/3/library/constants.html#True'>True</a></code> in their metadata.</p>
</div>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>ModelT</code></dt>
<dd>The new deep copied attrs model.</dd>
</dl>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/internal/attr_extensions.py#L221-L247" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">def deep_copy_attrs(model: ModelT, memo: typing.Optional[typing.MutableMapping[int, typing.Any]] = None) -&gt; ModelT:
    &#34;&#34;&#34;Deep copy an attrs model with `init` enabled.

    Parameters
    ----------
    model : ModelT
        The attrs model to deep copy.
    memo : typing.Optional[typing.MutableMapping[builtins.int, typing.Any]]
        A memo dictionary of objects already copied during the current copying
        pass, see https://docs.python.org/3/library/copy.html for more details.

    !!! note
        This won&#39;t deep copy attributes where &#34;skip_deep_copy&#34; is set to
        `builtins.True` in their metadata.

    Returns
    -------
    ModelT
        The new deep copied attrs model.
    &#34;&#34;&#34;
    if memo is None:
        memo = {}

    new_object = std_copy.copy(model)
    memo[id(model)] = new_object
    get_or_generate_deep_copier(type(model))(new_object, memo)
    return new_object</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.internal.attr_extensions.invalidate_deep_copy_cache" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="invalidate_deep_copy_cache" href="#hikari.internal.attr_extensions.invalidate_deep_copy_cache" id="hikari.internal.attr_extensions.invalidate_deep_copy_cache">invalidate_deep_copy_cache</a>() -> None: ...</code></pre>
</dt>
<dd>
<p>Remove all the globally cached generated deep copy functions.</p>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/internal/attr_extensions.py#L57-L60" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">def invalidate_deep_copy_cache() -&gt; None:
    &#34;&#34;&#34;Remove all the globally cached generated deep copy functions.&#34;&#34;&#34;
    _LOGGER.debug(&#34;Invalidating attr extensions deep copy cache&#34;)
    _DEEP_COPIERS.clear()</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.internal.attr_extensions.invalidate_shallow_copy_cache" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="invalidate_shallow_copy_cache" href="#hikari.internal.attr_extensions.invalidate_shallow_copy_cache" id="hikari.internal.attr_extensions.invalidate_shallow_copy_cache">invalidate_shallow_copy_cache</a>() -> None: ...</code></pre>
</dt>
<dd>
<p>Remove all the globally cached copy functions.</p>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/internal/attr_extensions.py#L51-L54" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">def invalidate_shallow_copy_cache() -&gt; None:
    &#34;&#34;&#34;Remove all the globally cached copy functions.&#34;&#34;&#34;
    _LOGGER.debug(&#34;Invalidating attr extensions shallow copy cache&#34;)
    _SHALLOW_COPIERS.clear()</code></pre>
</details>
</dd>
<div class="sep"></div>
<dt>
<pre><code id="hikari.internal.attr_extensions.with_copy" class="hljs python"><abbr title='A standard Python function.'>def</abbr> <a title="with_copy" href="#hikari.internal.attr_extensions.with_copy" id="hikari.internal.attr_extensions.with_copy">with_copy</a>(
    cls: <a href='https://docs.python.org/3/library/typing.html#typing.Type'>Type</a>[ModelT],
) -> Type[~ModelT]: ...</code></pre>
</dt>
<dd>
<p>Add a custom implementation for copying attrs models to a class.</p>
<div class="alert alert-success">
<p class="admonition-title">Note</p>
<p>This will only work if the class has an attrs generated init.</p>
</div>
<details class="source">
<summary>
<span>Expand source code</span>
<br />
<a href="https://github.com/hikari-py/hikari/blob/c8d88c83b926f0874158593f8bc7ba0f580a97d8/hikari/internal/attr_extensions.py#L250-L258" class="git-link dotted">Browse git</a>
</summary>
<pre><code class="python">def with_copy(cls: typing.Type[ModelT]) -&gt; typing.Type[ModelT]:
    &#34;&#34;&#34;Add a custom implementation for copying attrs models to a class.

    !!! note
        This will only work if the class has an attrs generated init.
    &#34;&#34;&#34;
    cls.__copy__ = copy_attrs  # type: ignore[attr-defined]
    cls.__deepcopy__ = deep_copy_attrs  # type: ignore[attr-defined]
    return cls</code></pre>
</details>
</dd>
<div class="sep"></div>
</dl>
</section>
</div>
</div>
</div>
<!-- Search script and dependencies -->
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../search.html#' + encodeURIComponent(query);
window.location.href = url;
};
</script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>